<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!--
  Copyright 2014 by Citrix Systems, Inc.  Created by Gordon Stretch <Gordon.Stretch@citrix.com>. This work is licensed under the Creative Commons Attribution 4.0 International License. To view a copy of this license, visit http://creativecommons.org/licenses/by/4.0/.
-->


<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" "../../../../doctools/docbook-xml/docbookx.dtd"[
<!ENTITY % xinclude PUBLIC "xinclude" "../../../../doctools/docbook-xml/xinclude.mod">
%xinclude;
  <!ENTITY colophon PUBLIC "colophon" "../../../../shared/xml/colophon.ent">
  <!ENTITY legal PUBLIC "legal" "../shared/legal.ent">
  <!ENTITY view_details PUBLIC "view_details" "../shared/view_details.ent">
  <!ENTITY shared_upgrade_and_install_steps PUBLIC "shared_upgrade_and_install_steps" "../shared/shared_upgrade_and_install_steps.ent">
  <!ENTITY choose_xt_installation_medium PUBLIC "choose_xt_installation_medium" "../shared/choose_xt_installation_medium.ent">
  <!ENTITY % local PUBLIC "local" "../shared/local.ent">
  %local;
]><book id="XTEngineAdminstratorGuide" lang="en"><?dbhtml dir="XTEngineAdminstratorGuide"?>
 <bookinfo id="bookinfo_titlestuff" role="die">
  <title>&COMPANY_NAME_SHORT;<trademark class="registered" role="die"/> &PRODUCT_BRAND;<trademark class="trade"/> &PRODUCT_VERSION; Engine Administrator Guide</title>
  <pubdate><?dbtimestamp format="d B Y"?></pubdate>
  <releaseinfo>High-assurance isolation &amp; security for virtual environments</releaseinfo>  
  &legal;
  
 </bookinfo>
 <chapter><title>Overview and System Setup</title>

 <para>Citrix &PRODUCT_BRAND; provides a local virtualized desktop with enhanced isolation of mutually distrusting virtual machines (VMs). It improves VM isolation while retaining the industry-leading user experience of of XenClient Enterprise on COTS desktop hardware. &PRODUCT_BRAND; supports the customization of isolation policies for a variety of enterprise mobile and desktop use cases. &PRODUCT_BRAND; extends the capabilities of XenClient Enterprise with the following features:</para>
 <itemizedlist>

<listitem><para>Service VM architecture for extensibility and secure isolation of critical services</para></listitem>
<listitem><para>Rich APIs for partner extensibility</para></listitem>
<listitem><para>Secure Measured Launch using Intel Trusted Execution Technology (TXT)</para></listitem>
<listitem><para>Multiple GPU and seamless mouse support, allowing you to run multiple &HDX; VMs on separate monitors</para></listitem>
<listitem><para>Read-only control domain</para></listitem>
<listitem><para>Encrypted VM disks.</para></listitem>
<listitem><para>SELinux and XSM (Xen Security Modules) policy enforcement</para></listitem>
<listitem><para><indexterm><primary>Networking</primary><secondary>Network Driver Domain VM (NDVM)</secondary></indexterm>Network Driver Virtual Machine (NDVM) that provides an isolated networking service for VMs</para></listitem>
<listitem><para>VM disk persistence for returning a VM to its original state on each reboot</para></listitem>

 </itemizedlist>
 <para>Centrally mange your &PB; devices and VMs using &PB; &BACKEND;. See <citetitle>&COMPANY_NAME_SHORT;<trademark class="registered" role="die"/> &PRODUCT_BRAND;<trademark class="trade"/> &BACKEND; &PRODUCT_VERSION; Administrator Guide</citetitle> for more information about &PB; &BACKEND;.</para>
<note><para>&PRODUCT_BRAND; is licensed, distributed and installed separately from XenClient Enterprise.</para></note>

<section><title>Hardware Compatibility</title>

<para>&PRODUCT_BRAND; supports the following systems and devices. Newly-supported devices in this release are listed in bold text:</para>

<section><title>Laptop Systems</title>
<itemizedlist>
<listitem><para>HP EliteBook 8460p</para></listitem>
<listitem><para>HP EliteBook 8440p</para></listitem>
<listitem><para>HP EliteBook 2560p</para></listitem>
<listitem><para>HP EliteBook 2760p</para></listitem>

<listitem><para><emphasis role="bold">HP EliteBook 2170p</emphasis></para></listitem>
<listitem><para><emphasis role="bold">HP EliteBook 2570p</emphasis></para></listitem>
<listitem><para><emphasis role="bold">HP EliteBook 8470p</emphasis></para></listitem>
<listitem><para><emphasis role="bold">HP EliteBook 8570p</emphasis></para></listitem>
<listitem><para><emphasis role="bold">HP EliteBook 9470m</emphasis></para></listitem>


<listitem><para>Dell Latitude E6420</para><note><para>BIOS A13 on the E6420 is not compatible with Intel TXT and the Measured Launch feature of &PB;.</para></note></listitem>
<listitem><para>Dell Latitude E6410</para></listitem>
<listitem><para>Dell Latitude E6220</para><note><para>BIOS A08 on the E6220 is not compatible with Intel TXT and the Measured Launch feature of &PB;.</para></note></listitem>

<listitem><para><emphasis role="bold">Dell Latitude E6230</emphasis><footnote id="dell_ivybridge-issue"><para>Warning: Current BIOS versions of Dell systems with 3rd-generation i5 and i7 CPUs (Ivy Bridge) have bugs related to Measured Launch. If you are using one of these systems, you will be warned when setting up Measured Launch. On a system with these problems, the measurement stored by the BIOS in PCR[1] must be excluded from the PCR values used to seal the XenClient XT Engine config partition. For a description of PCR[1] and the contents measured within see the XenClient XT Architecture Guide. When Dell issues a new BIOS with this issue resolved, the value of PCR[1] can be added back to the measurement list by an administrator using <xref linkend="restore_pcr1" />.</para></footnote></para></listitem>
<listitem><para><emphasis role="bold">Dell Latitude E6330</emphasis><footnoteref linkend="dell_ivybridge-issue" /></para></listitem>
<listitem><para><emphasis role="bold">Dell Latitude E6430</emphasis><footnoteref linkend="dell_ivybridge-issue" /></para></listitem>
<listitem><para><emphasis role="bold">Dell Latitude E6430S</emphasis><footnoteref linkend="dell_ivybridge-issue" /></para></listitem>
<listitem><para><emphasis role="bold">Dell Latitude E6530</emphasis><footnoteref linkend="dell_ivybridge-issue" /></para></listitem>

<listitem><para><emphasis role="bold">Lenovo X230</emphasis></para></listitem>
<listitem><para><emphasis role="bold">Lenovo T430</emphasis></para></listitem>
<listitem><para><emphasis role="bold">Lenovo T430S</emphasis></para></listitem>
<listitem><para><emphasis role="bold">Lenovo T520</emphasis></para></listitem>
<listitem><para><emphasis role="bold">Lenovo T530</emphasis></para></listitem>
<listitem><para><emphasis role="bold">Lenovo ThinkPad X1 Carbon</emphasis></para></listitem>
</itemizedlist>

</section>

<section><title>Desktop Systems</title>
<itemizedlist>
<listitem><para>HP 8100 mini-tower</para></listitem>
<listitem><para>HP 8200 mini-tower</para></listitem>
<listitem><para><emphasis role="bold">HP Z220</emphasis></para></listitem>
<listitem><para><emphasis role="bold">HP 8300 mini-tower</emphasis></para></listitem>
<listitem><para><emphasis role="bold">HP 8300</emphasis></para></listitem>
<listitem><para>Dell 980 mini-tower</para></listitem>
<listitem><para>Dell 980 small form factor (SFF)</para></listitem>
<listitem><para>Dell 990 mini-tower</para></listitem>
<listitem><para>Dell 990 small form factor (SFF)</para></listitem>
<listitem><para><emphasis role="bold">Dell 9010</emphasis><footnoteref linkend="dell_ivybridge-issue" /></para></listitem>
<listitem><para><emphasis role="bold">Dell 9010 (SFF)</emphasis><footnoteref linkend="dell_ivybridge-issue" /></para></listitem>
<listitem><para><emphasis role="bold">Lenovo M92P (SFF)</emphasis></para></listitem>
<listitem><para><emphasis role="bold">Lenovo M92P (Tiny)</emphasis></para></listitem>
<listitem><para><emphasis role="bold">Lenovo M91P (SFF)</emphasis></para></listitem>
</itemizedlist>
<para id="gpu_pt_caveat">SFF systems currently do not support GPU add-on devices.</para>
</section>

<section><title>Discrete Graphics Processors</title>
<itemizedlist>
<listitem><para>ATI Radeon HD 4550 PCI Express</para></listitem>
<listitem><para>ATI Radeon HD 5450 PCI Express</para></listitem>
<listitem><para>ATI Radeon HD 5500 PCI Express</para></listitem>
<listitem><para>ATI Radeon HD 6570 PCI Express</para></listitem>
<listitem><para>NVIDIA Quadro 2000</para></listitem>
</itemizedlist>

<note><para>The combination of an HP 8200 using an ATI Radeon HD 6570 is not supported. The specific problem described in the <citetitle>&COMPANY_NAME_SHORT;<trademark class="registered"/> &PB;<trademark class="trade"/> &PRODUCT_VERSION; Release Notes</citetitle>.</para></note>
</section>

<section><title>Network Interfaces</title>
<itemizedlist>
<listitem><para>PCI Express Network Interface Card (NIC), e.g. Broadcom NetExtreme II 5722</para></listitem>
</itemizedlist>
</section>
	
<section><title>Intel TXT and Intel AMT</title>

<para><indexterm><primary>Trusted Execution Technology (TXT)</primary></indexterm>For &PB; use cases which require Intel Trusted Execution Technology (TXT), but not Intel Active Management Technology (AMT), the following options are available from system manufacturers and are supported by &COMPANY_NAME_SHORT;:</para>
<orderedlist>
<listitem><para>Contact your system manufacturer to purchase a non-vPro SKU variant of a supported desktop and an Intel CPU that supports TXT and VT-d.</para></listitem>
<listitem><para>Purchase and install a third-party PCI Express network interface card in a supported desktop. Use the System BIOS to disable the onboard, integrated Intel NIC. AMT must remain enabled in the system BIOS.</para></listitem>
</orderedlist>
</section>

</section>

<section><title>Device Preparation before &PB; Installation</title>

<procedure><title>Before Installing &PB; on All Devices</title>
<step><para>Install the most recent BIOS version available from the system manufacturer. In some cases the most recent BIOS may be incompatible with &PB;. See the <citetitle>Citrix &PB; &PRODUCT_VERSION; Release Notes</citetitle> for details.</para></step>
<step><para>Enable the following Intel vPro features in the system BIOS:</para>
<substeps>
 <step><para>VT-x</para></step>
 <step><para>VT-d</para></step>
 <step><para>TPM</para></step>
 <step><para>TXT</para></step>
</substeps>
</step>
</procedure>

<procedure><title>Before Installing &PB; on a Dell or HP Desktop With an Nvidia or ATI Video Card</title>
<step><para>Install the video card in PCI Express slot 4.</para></step>
<step><para>In the BIOS video configuration menu:</para>
<substeps>
<step><para>Enable the Intel integrated video adapter.</para></step>
<step><para>Specify Intel as the primary video adapter.</para></step>
</substeps>
</step>
</procedure>



<procedure><title>Before Installing &PB; on a Dell 980</title>
<step><para>Disable unused devices in the BIOS to reduce interrupt conflicts:</para>

<substeps>
 <step><para>Set <guilabel>System Configuration &gt; Serial Port #2</guilabel> to <guilabel>Disabled</guilabel>.</para></step>
 <step><para>Set <guilabel>System Configuration &gt; Parallel</guilabel> to <guilabel>Disabled</guilabel>.</para></step>  
 <step><para>Set <guilabel>Drives &gt; SATA-2</guilabel> to <guilabel>Disabled</guilabel>.</para></step>
 <step><para>Set <guilabel>Drives &gt; SATA-3</guilabel> to <guilabel>Disabled</guilabel>.</para></step>
  <step><para>Set <guilabel>Drives &gt; External SATA</guilabel> to <guilabel>Disabled</guilabel>.</para></step>
 <step><para>Set <guilabel>Miscellaneous Devices &gt; WiFI NIC Slot</guilabel> to <guilabel>Disabled</guilabel>.</para></step>
<step><para>Set <guilabel>Miscellaneous Devices &gt; Optiplex ON Reader</guilabel> to <guilabel>Disabled</guilabel>.</para></step>
 </substeps>
</step>
</procedure>
</section>


<section><title>Setup Instructions</title>
<para><indexterm><primary>Installing &PB;</primary></indexterm><indexterm><primary>Upgrading &PB;</primary></indexterm>After you have updated and configured your BIOS, use the following procedure to prepare your &PB; device:</para>
<orderedlist>
<listitem><para>Install &PB; on the target device using the installation media.</para></listitem>
<listitem><para>Create a VM. See <olink targetdoc="XTEngineAdministratorGuide" targetptr="installing_vms" /> for more information.</para></listitem>
<listitem><para>Install an operating system on the VM. See <olink targetdoc="XTEngineAdministratorGuide" targetptr="install_os" /> for more information.</para></listitem>
<listitem><para>Install the &PV_TOOLS; on the VM. See  <olink targetdoc="XTEngineAdministratorGuide" targetptr="install_pv_tools"/> for more information.</para></listitem>
<listitem><para>Install any other VMs in the same manner.</para></listitem>
<listitem><para>Perform any optional VM and platform configuration required. See <olink targetdoc="XTEngineAdministratorGuide" targetptr="vm_configuration"/> and <olink targetdoc="txt_setup" targetptr="platform_configuration"/> for more information.</para></listitem>
</orderedlist>

<section id="installation-media"><title>Installation Media<indexterm><primary>&PB;</primary><secondary>installation media</secondary></indexterm></title>
<para>You can install &PB; from optical media or a USB storage device.</para>

<para>To use optical media, burn an image of the ISO file to a blank CD or DVD. From Windows 7 you can right-click on the ISO file and select <guilabel>Burn Disk Image</guilabel> and follow the prompts. From a Linux system there are similar methods from the graphical interface, or you can use the <command>dd</command> command. See the documentationof your Linux distribution for more information.</para>

<para>To use a USB storage device, you need to make the device bootable as well as image the ISO file.</para>

<para>From a Windows system, you can use the utility <emphasis>UNetbootin</emphasis>, which is available from the Citrix website.</para>

<procedure id="imaging-iso-to-usb-stick"><title>To create a bootable ISO image on a USB storage device on Windows</title>
<para>Download and install UNetbootin from the Citrix download portal at <ulink url="www.mycitrix.com">www.mycitrix.com</ulink>.</para>
<note><para>If you retrieve the UNetbootin distribution from another location, ensure that it is at least version 549 or newer.</para></note>

	<step><para>Insert your USB storage device in a USB port.</para></step>
	<step><para>Launch UNetbootin and select <guilabel>DiskImage</guilabel>.</para></step>
	<step><para>Click on the browse button the right of the <guilabel>ISO</guilabel> field and browse to the location of the ISO.</para></step>
	<step><para>With <guilabel>Type</guilabel> set to <emphasis>USB Drive</emphasis>, use the drop-down menu to select the drive letter of your USB storage device.</para></step>
	<step><para>Click <guilabel>OK</guilabel>. You will see a progress bar as the USB device is prepared and the ISO is imaged.</para></step>
	<step><para>Once the process is complete, click <guilabel>Exit</guilabel>.</para></step>
</procedure>

<para>From a Linux system, there are similar methods from the graphical interface, or you can use the <command>cat</command> from a command line shell. With the USB storage device in place, enter:</para>
<screen>cat installer.iso > /dev/sd<replaceable>x</replaceable></screen>
<para>where <emphasis>x</emphasis> is the correct drive ID for your USB storage device.</para>
<warning><para>Be sure to triple-check the target for the <command>cat</command>, to avoid erasing another drive, potentially the one with your Linux OS on it!</para></warning>

</section>

<section id="installing_xc"><title>Installing or Upgrading</title>
	<para>See <olink role="die" targetdoc="XTReleaseNotes" targetptr="known_issues"/> for any known issues that might affect your installation.</para>

<important><para>Before upgrading &PB;, ensure that all VMs on the &PB; device are shut down.</para></important>

<para>&PB; offers two installation modes: quick installation or advanced installation. Use the arrow keys and the <keycap>Enter</keycap> key to navigate through the installation wizard. Press <keycap>Esc</keycap> to go back a step.</para>

<note><para>The display might switch off during the late stages of installation. This is no cause for concern. Simply press any key on the keyboard to wake the display up.</para></note>

    <procedure id="quick_install">
		<title>To Perform a Quick Install or Upgrade</title>
		<para><indexterm><primary>&PB;</primary>
<secondary>installing, quick</secondary></indexterm>Quick install does not include the option to enable ssh access to the control domain nor to enable Measured Launch. If you choose <guilabel>Quick install</guilabel> and later decide to enable ssh access, you can do so by opening a command-line terminal from the &PB; control domain and entering the command <command>xec set enable-ssh true</command>.  See <xref linkend="enable_txt_after_install"/> for further details about enabling Measured Launch on a running installation.</para>
		<step>
		<para>Boot from the &PRODUCT_BRAND; installation media or network in the case of a PXE boot setup.</para></step>
		<step>
		<para>Choose <guilabel>Quick install</guilabel>.</para>
		</step>
		<step>
		<para>Choose <guilabel>OK</guilabel> and review the software license.</para>
		</step>
		<step>
		<para>Choose <guilabel>OK</guilabel>, then <guilabel>Yes</guilabel> to accept the terms of the license.</para>
		</step>
		<!--
		<step>
		<para>Select the language and choose <guilabel>Select</guilabel>.</para>
		</step>
		-->
		<step>
		<para>Select the keyboard layout of the device and choose <guilabel>Select</guilabel>.</para>
		</step>
<!-- 		
&choose_xt_installation_medium;
-->
	<step><para>Choose <guilabel>Verify</guilabel> to ensure that the installation media is valid and uncorrupted, or <guilabel>Skip</guilabel>.</para></step>
	<step><para>If an existing &PB; installation is detected, you are presented with the option to <guilabel>Refresh</guilabel> or perform a <guilabel>Fresh Install</guilabel>. If you select <guilabel>Refresh</guilabel>, &PB; will be upgraded to the newer version of the software and your existing settings and VMs preserved. When the upgrade is complete, you are prompted to reboot.</para>
	<note><para>If you choose to upgrade from a previous version, you will need to update the &PV_TOOLS; on all VMs.</para></note>
    <note><para>If you chose to upgrade or refresh an existing system that has been configured for Measured Launch using install media (CDROM etc) you will be required to enter the administrative password during the first boot sequence after the upgrade.</para></note>
	<para>If you choose <guilabel>Fresh Install</guilabel>, the installation procedure continues in the next step below.</para></step> 
	<step><para>You are warned that the hard drive partition will be overwritten. Select <guilabel>Continue</guilabel>.</para>
	<note><para>If the device has OEM partitions on it, the installer detects this and gives you a choice of leaving these partitions intact or removing them and using the entire hard drive.</para></note>
	</step>
	<step><para>Next you are prompted to provide a password for the system. You will need this password to log in to the control domain and generate status reports or perform other diagnostics. Enter the password and choose <guilabel>OK</guilabel>.</para></step>
	<step><para>You are then prompted to confirm your password by entering it again. Enter the password and choose <guilabel>OK</guilabel>.</para></step>
	<step><para>The installation commences, and a progress bar is displayed. When the installation has completed, choose <guilabel>Continue</guilabel> and then <guilabel>Reboot</guilabel> to reboot the machine.</para></step>
	<step><para>When the device has rebooted the &BRAND_CONSOLE; is displayed. If you have performed an upgrade from a previous version of &PB;, you need to update the &PV_TOOLS; software installed on the VMs on your &PB; device. To upgrade the &PV_TOOLS;, first uninstall the existing &PV_TOOLS; and then run the &PV_TOOLS; installer.</para>
	<note><para>If &HDX; is enabled on your VM, before upgrading the &PV_TOOLS;, shut down the VM, disable &HDX;, then boot the VM.</para></note></step>
	</procedure>
	
<procedure id="advanced_install">
		<title>To Perform an Advanced Install or Upgrade<indexterm><primary>&PB;</primary> 
<secondary>installing, advanced</secondary></indexterm><indexterm><primary>&PB;</primary>
<secondary>upgrading</secondary></indexterm></title>
		<step>
		<para>Boot from the &PRODUCT_BRAND; installation media.</para></step>
		<step>
		<para>Choose <guilabel>Advanced Install</guilabel>.</para>
		</step>
<step>
		<para>Choose <guilabel>OK</guilabel> and review the software license.</para>
</step>
		<step>
		<para>Choose <guilabel>OK</guilabel> and <guilabel>Yes</guilabel> to accept the terms of the license.</para>
		</step>
		<!--
		<step>
		<para>Select the language and choose <guilabel>Select</guilabel>.</para>
		</step>
		-->
		<step><para>Select the keyboard layout of the device and choose <guilabel>Select</guilabel>.</para></step>
		
		<step><para>You are asked if you have any optional Supplemental Packs that you want to install. Choose <guilabel>Yes</guilabel> or <guilabel>No</guilabel>.</para></step>
		
		<step><para>Choose <guilabel>Verify</guilabel> to ensure that the installation media is valid and uncorrupted, or <guilabel>Skip</guilabel> to move to the next installation step.</para></step>
		  
		<step><para>If an existing &PB; installation is detected, you are presented with the option to <guilabel>Refresh</guilabel> or perform a <guilabel>Fresh Install</guilabel>. If you select <guilabel>Refresh</guilabel>, &PB; will be upgraded to the newer version of the software and your existing settings and VMs preserved. When the upgrade is complete, you are prompted to reboot.</para>
		<note><para>If you choose to upgrade from a previous version, you will need to update the &PV_TOOLS; on all VMs.</para></note>
		<para>If you choose <guilabel>Fresh Install</guilabel>, the installation procedure continues in the next step below.</para></step> 
		
		<step><para>You are warned that the hard drive partition will be overwritten. Select <guilabel>Continue</guilabel>.</para>
		<note><para>If the device has OEM partitions on it, the installer detects this and gives you a choice of leaving these partitions intact or removing them and using the entire hard drive.</para></note>
		</step>

		<step><para>Choose <guilabel>Continue</guilabel> to begin the installation.</para></step>
		
		<step><para>Next you are prompted to provide a password for the system. You will need this password to log in to the control domain and generate status reports or perform other diagnostics.  Enter the password and choose <guilabel>OK</guilabel>.</para></step>
		<step><para>You are then prompted to confirm your password by entering it again. Enter the password and choose <guilabel>OK</guilabel>.</para></step>
		<step><para>Select <guilabel>Yes</guilabel> to enable remote access to the &PB; device over SSH. This allows you to connect directly to the &PB; hypervisor file system to perform diagnostic tasks.</para></step>
        <step><para>Follow through the steps for configuring Measured Launch, if you wish to have this enabled.  Enabling Measured Launch is the recommended configuration, though it requires additional configuration in the system BIOS.  If you need to make BIOS configuration changes, you will be prompted to do so.</para></step>
		
		<!--
		<step>
		<para>Choose <guilabel>Register</guilabel> to enter a &BACKEND; URL.</para>
		</step>
		<step><para>Enter the address of your &BACKEND; server and click <guilabel>OK</guilabel>.</para></step>
		<step><para>Enter the path to a root certificate to be used to authenticate your &BACKEND; server, or leave the field empty if you do not want to specify a certificate. Choose <guilabel>OK</guilabel>.</para>
		<para>If the &BACKEND; server is configured to require <indexterm><primary>Registration PIN</primary></indexterm>Registration PINs, you are also prompted to enter the required PIN now. Enter the PIN provided by your system administrator.</para>
		<para>If you do not want to register with a &BACKEND;, choose <guilabel>Skip</guilabel>.</para>
		</step>
		<para>Choose <guilabel>Continue</guilabel>.</para>
		</step>
		-->
		
		<step><para>When the installation has completed, press <guilabel>Continue</guilabel> and then <guilabel>Reboot</guilabel> to reboot the machine.</para></step>
		<step><para>When the device has rebooted the &BRAND_CONSOLE; is displayed. If you have performed an upgrade from a previous version of &PB;, you need to update the &PV_TOOLS; software installed on the VMs on your &PB; device. To upgrade the &PV_TOOLS;, first uninstall
the existing &PV_TOOLS; and then run the &PV_TOOLS; installer.</para>
		<note><para>If &HDX; is enabled on your VM, before upgrading the &PV_TOOLS;, shut down the VM, disable &HDX;, then boot the VM.</para></note>
		</step>
	</procedure> 
</section>

</section>

<section id="measured_launch"><title>Measured Launch for the Control Domain</title>
<para><indexterm><primary>Trusted Execution Technology (TXT)</primary></indexterm><indexterm><primary>Measured Launch</primary></indexterm>When enabled, &PB; Measured Launch measures security-critical components in the Engine Control Domain. &PB; relies on features in the hardware to assist in measuring software components early in the boot process and to provide protection from tampering by other system software. This requires device support for Intel vPro hardware.</para>

<warning><para>The machine must be vPro-compliant for TXT to work properly (the Intel sticker should mention &quot;vPro&quot;). In addition, the BIOS must be configured properly.</para></warning>

<para>With Measured Launch enabled, any changes to the system or boot options will result in a prompt for the administrator password before the system continues booting. When the prompt is displayed, you can choose for this single boot to be allowed with the modification, or for the changes to be permanently allowed on subsequent boots. If the changes are not permanently allowed, the administrative password will be required on all subsequent boots until the changes are allowed permanently, or reverted.</para>

<warning>
<para>Some BIOS versions of Dell systems with 3rd-generation i5 and i7 CPUs (Ivy Bridge) have bugs related to Measured Launch. If you are using one of these systems, you will be warned when setting up Measured Launch. On a system with these problems, the measurement stored by the BIOS in PCR[1] must be excluded from the PCR values used to seal the &PB; Engine configuration partition. For a description of PCR[1] and the contents measured within see the <citetitle>&PB; Architecture Guide</citetitle>.</para>
<para>When Dell issues a new BIOS with this issue resolved, the value of PCR[1] can be added back to the measurement list by an administrator using the procedure <xref linkend="restore_pcr1" />.</para>
</warning>

<section id="enable_txt_install"><title>Enabling Measured Launch for the Control Domain at Installation</title>
<para><indexterm><primary>Measured Launch</primary></indexterm>It is possible to enable Measured Launch during the setup procedure using the <emphasis>Advanced installation</emphasis> option. This method is automated and will walk you through proper configuration. This is the recommended configuration method.</para>

<note><para>Enabling Measured Launch at installation time will cause two additional reboots during the first boot process. The first boot of a &PB; system typically requires one reboot after some file system operations are performed. The initial Measured Launch sealing operation must be performed after these file system operations are completed. The system will reboot again after the initial sealing operation. This final reboot will be the first  first Measured Launch of the platform.</para></note>
</section>

<section id="enable_txt_after_install"><title>Enabling Measured Launch for the Control Domain After Installation</title>
<para><indexterm><primary>Measured Launch</primary></indexterm>&COMPANY_NAME_SHORT; highly recommends configuring Measured Launch at install time. It is possible, however, to enable Measured Launch after installation using the following steps:</para>
<warning>
<para>The following steps <emphasis>must</emphasis> be performed <emphasis>exactly</emphasis> as described, in the <emphasis>exact order</emphasis> given below, before installing &PB;. If this procedure is not executed successfully, all VMs that are encrypted will <emphasis>not</emphasis> be protected.</para></warning>

<procedure><title>To Enable Measured Launch</title>
<step><para>Update the system BIOS to the latest version available from the OEM.</para></step>
<step><para>Boot the system and enter the BIOS setup.</para></step>
<step><para>Disable the serial port and the parallel port. We also recommend that you disable any other devices or ports that you do not plan on using.</para></step>
<step><para>Exit the BIOS setup, saving the changes, reboot, and enter the BIOS setup again.</para></step>
<step><para>Disable TXT.</para></step>
<step><para>Exit the BIOS setup, saving the changes, reboot, and enter the BIOS setup again.</para></step>
<step><para>Clear the TPM (this will also disable it).</para></step>
<step><para>Exit the BIOS setup, saving the changes, reboot, and enter the BIOS setup again.</para></step>
<step><para>Enable the TPM.</para></step>
<step><para>Exit the BIOS setup, saving the changes, and power off the machine (do NOT reboot).</para></step>
<step><para>Power up the machine, enter the BIOS setup again and enable TXT.</para></step>
<step><para>Exit the BIOS setup, saving the changes, and again power off the machine (do NOT reboot).</para></step>
<step><para>Power up the machine, boot to the installation media, and install &PB;.</para></step>
<step><para>Once installed, when &PB; boots, before doing anything else, open a command prompt (<keycap>CTRL+SHIFT+T</keycap>, and as an SELinux admin (see <xref linkend="selinux_enter_admin" /> for how to enter the SELinux admin role), run the following command:</para>
<screen>tpm-setup</screen>
</step>
<step><para>Close the command prompt window.</para></step>
<step><para>Restart the machine by clicking the <guilabel>Power</guilabel> on the upper left corner of the &BC; and selecting <guilabel>Restart</guilabel>.</para></step>
<step><para>On the initial boot after running <command>tpm-setup</command>, the control domain filesystem is inspected and the results stored in the TPM. After boot, it is necessary to restart again immediately, by clicking the <guilabel>Power</guilabel> on the upper left corner of the &BC; and selecting <guilabel>Restart</guilabel>.</para></step>
</procedure>

<warning>
<para>After you enable TXT and TPM in the system BIOS, be sure to complete the tpm-setup process as soon as possible.</para>
<itemizedlist>
  <listitem><para>If TXT and TPM are BIOS-enabled but the tpm-setup procedure is incomplete, you might experience hardware-specific instability. For example, the device may not sleep properly in this state. Time spent in such a state must be minimized at all costs. No VM or platform operations should be performed in this state.</para></listitem>
  <listitem><para>To minimize system exposure to remote attackers before the tpm-setup procedure is complete, perform &PB; platform provisioning and tpm-setup in an isolated network or standalone configuration. The tpm-setup procedure should be completed as soon as possible after &PB; installation.</para></listitem>
</itemizedlist>
</warning>

</section>
<section id="section_restore_pcr1"><title>Restoring PCR[1] to Measured Launch Configuration</title>
<procedure id="restore_pcr1"><title>To restore PCR[1] to the list of PCRs to which the Engine config partition is sealed<indexterm><primary>Measured Launch</primary></indexterm></title>
    <step><para>&OPEN_CONSOLE;</para></step>
    <step><para>Enter the SELinux administrative domain as described in <xref linkend="selinux_enter_admin"/></para></step>
    <step><para>Execute the following command to add PCR[1] to the list of PCRs included in the seal operation:</para>
        <screen>sed -i -e &apos;s&amp;^\(.*\)^&amp;\1 -p 1&amp;&apos; /config/config.pcrs</screen>
    </step>
    <step><para>Mount the file system writable to force the system to reseal itself:</para>
        <screen>rw</screen>
    </step>
    <step><para>Reboot the system after powering off all VMs. PCR[1] will not be restored to the measurement list until the platform is rebooted. On reboot, the administrative password will be required to reseal the platform.</para></step>
</procedure>
</section>
</section>

<section id="selinux_xsm"><title>SELinux and XSM Policy in the Control Domain</title>
<para>By default, SELinux and XSM (Xen Security Modules) policy in the control domain is in the enforcing mode. The following sections describe the ways in which you can change this behavior for the current &PB; session, or through configuration options that are put into effect on each system boot. This section closes with a brief discussion of the effect SELinux has on the execution of system administration commands.</para>

<section id="selinux_mode"><title>Possible Modes of Operation for SELinux and XSM</title>
 <para>There are 3 possible values for SELinux in the <literal>/etc/selinux/config</literal> file. This file is parsed on system boot and this value determines how SELinux behaves when the policy is loaded into the kernel. These modes are defined by the values:</para>
 <itemizedlist>
  <listitem><para><literal>enforcing</literal>, which enables all SELinux functionality.</para></listitem>
  <listitem><para><literal>permissive</literal>, which allows operations but creates a log of operations that would be denied if SELinux was set to <literal>enforcing</literal>.</para></listitem>
  <listitem><para><literal>disabled</literal>, which disables SELinux in the kernel. Putting the system into this state is highly discouraged.</para></listitem>
 </itemizedlist>
 <para>When XSM policy is present the &PB; hypervisor has only two modes of operation:</para>
 <itemizedlist>
  <listitem><para><literal>enforcing</literal>, which enables all XSM functionality.</para></listitem>
  <listitem><para><literal>permissive</literal>, which allows operations but creates a log of operations that would be denied if XSM was set to <literal>enforcing</literal>.</para></listitem>
 </itemizedlist>
 <para>XSM has no equivalent of the SELinux <literal>disabled</literal> mode when a policy is loaded.</para>
</section>

<section><title>Controlling SELinux Policy Enforcement on System Boot</title>
 <para>By default, SELinux policy in the control domain is in enforcing mode. This can be seen by consulting the <literal>/etc/selinux/config</literal> file and viewing its contents:</para>
  <screen>SELINUX=enforcing
SELINUXTYPE=targeted</screen>
  <para>Any change to this file requires a system reboot to take effect.  Runtime changes to the SELinux enforcement status can be made by following the instructions in <xref linkend="selinux_mode_change" />.</para>
 
  <procedure id="selinux_boot_permissive">
   <title>To change SELinux Policy Enforcement from Enforcing to Permissive</title>
   <step><para>&OPEN_CONSOLE;</para></step>
   <step><para>Enter the SELinux administrative domain as described in <xref linkend="selinux_enter_admin"/></para></step>
   <step><para>Run the following command:</para>
         <screen>sed -i -e &quot;s/SELINUX=enforcing/SELINUX=permissive/&quot; /etc/selinux/config</screen>
   </step>
  </procedure>
  
   <procedure id="selinux_boot_enforcing">
   <title>To change SELinux Policy Enforcement from Permissive to Enforcing</title>
   <step><para>&OPEN_CONSOLE;</para></step>
   <step><para>Enter the SELinux administrative domain as described in <xref linkend="selinux_enter_admin"/></para></step>
   <step><para>Run the following command:</para>
         <screen>sed -i -e &quot;s/SELINUX=permissive/SELINUX=enforcing/&quot; /etc/selinux/config</screen>
   </step>
  </procedure>
  
</section>

<section><title>Controlling XSM Policy Enforcement on System Boot</title>
 <para>The XSM policy is interpreted and enforced by the &PB; hypervisor. All data relevant to XSM is passed to the hypervisor as command-line options at boot time by the GRUB boot loader. Thus all configuration changes relevant to XSM must be made through the GRUB configuration file: <literal>/boot/system/grub/grub.cfg</literal>. Any change to this file requires a system reboot to take effect; no changes to XSM enforcement can be made at run time.</para>
  <procedure id="xsm_disable"><title>To Change XSM Policy Enforcement from Enforcing to Permissive</title>
  <step><para>&OPEN_CONSOLE;</para></step>
  <step><para>Enter the SELinux administrative domain as described in <xref linkend="selinux_enter_admin"/>.</para></step>
  <step><para>Run the following command:</para>
         <screen>sed -i -e &quot;s/flask_enforcing=1/flask_enforcing=0/&quot; /boot/system/grub/grub.cfg</screen>
  </step>
 </procedure>
 
 <procedure id="xsm_enable"><title>To Change XSM Policy Enforcement from Permissive to Enforcing</title>
  <step><para>&OPEN_CONSOLE;</para></step>
  <step><para>Enter the SELinux administrative domain as described in <xref linkend="selinux_enter_admin"/>.</para></step>
  <step><para>Run the following command:</para>
         <screen>sed -i -e &quot;s/flask_enforcing=0/flask_enforcing=1/&quot; /boot/system/grub/grub.cfg</screen>
  </step>
 </procedure>

</section>

<section id="selinux_mode_change"><title>Changing the SELinux Mode for the Current Session</title>
 <procedure id="selinux_mode_view"><title>To view the SELinux mode for the current session</title>
  <step><para>&OPEN_CONSOLE;</para></step>
  <step><para>Change to the administrative role as described in <xref linkend="selinux_enter_admin"/></para></step>
  <step><para>Execute the <command>getenforce</command> command.</para></step>
 </procedure>
 
 <procedure id="selinux_setenforce_permissive"><title>To change the SELinux mode to permissive</title>
  <step><para>&OPEN_CONSOLE;</para></step>
  <step><para>Change to the administrative role as described in <xref linkend="selinux_enter_admin"/></para></step>
  <step><para>Run the following command:</para>
   <screen>setenforce permissive</screen>
  </step>
  <step><para>To verify the command was successful you may execute the procedure described in <xref linkend="selinux_mode_view"/>.</para>
  </step>
 </procedure>
 <procedure id="selinux_setenforce_enforcing"><title>To change the SELinux mode to enforcing</title>
  <step><para>&OPEN_CONSOLE;</para></step>
  <step><para>It's assumed that if the administrator is putting SELinux into enforcing mode that the current mode is permissive and it will be unnecessary to change to the administrative role.</para></step>
  <step><para>Run the following command:</para>
   <screen>setenforce enforcing</screen>
  </step>
  <step><para>To verify the command was successful you may execute the procedure described in <xref linkend="selinux_mode_view"/>.</para>
  </step>
 </procedure>
</section>

<section id="selinux_administration_mode"><title>The Effect of SELinux on Administrative Commands</title>
 <para>&PB; supports many administrative functions while the SELinux policy is enforced. To execute administrative commands while SELinux is enforcing, the administrator must follow this procedure:
 </para>
 <procedure id="selinux_enter_admin"><title>Entering the Administrative Role</title>
  <step><para>&OPEN_CONSOLE;</para></step>
  <step><para>Verify your current role by executing the following command:</para>
   <screen>id -Z</screen>
   <para>Your role should be:</para>
   <screen>root:staff_r:staff_t:s0-s0:c0.c1023</screen>
  </step>
  <step><para>Run the following command to enter the administrative domain:</para>
   <screen>newrole -r sysadm_r</screen>
   <para><literal>sysadm_r</literal> is the identifier for the standard SELinux system administrator role.</para>
  </step>
  <step><para>Verify the role has changed to <literal>sysadm_r</literal> by executing the following command:</para>
   <screen>id -Z</screen>
   <para>Your role should now be:</para>
   <screen>root:sysadm_r:sysadm_t:s0-s0:c0.c1023</screen>
  </step>
  <step><para>Execute the command as you normally would.</para></step>
 </procedure>
 <para>If the command fails even while in the administrative role you may put SELinux into its permissive mode using the procedure described in <xref linkend="selinux_setenforce_permissive"/> and re-execute the command.</para>
</section>

<section id="setup-selinux_admin_disabling_enabling"><title>Temporarily Disabling SELinux To Allow File Writing</title>
<para>Before copying files to the control domain filesystem, for example ISOs or VHD files, you need to enter the SELinux administrative role, temporarily disable SELinux enforcement, and set the filesystem to read/write. After copying the desired files, re-enable SELinux and reset the file system to read only.</para>
<note><para>You can also use the <filename>/tmp</filename> directory, which is by default read/write.</para></note>

<procedure id="proc-disable_selinux_enforcement"><title>To Temporarily Disable SELinux To Allow File Writing</title>
<step><para>&OPEN_CONSOLE;</para></step>

<step><para>Enter the following commands:</para>
<screen>nr
setenforce 0
rw</screen>
</step>

<step><para>When you have completed your copy operation, run the following commands to re-enable SELinux and reset the filesystem to read only:</para>
<screen>setenforce 1
ro</screen>
</step>
</procedure>

</section>

</section>
</chapter>

<chapter id="using_bc"><title>Using &PB;</title>

<para>When you start your &PB; device, the &BRAND_CONSOLE; UI is displayed. This is the user interface that allows you to manage your &PB; device and the VMs installed on it. Using &BC; you can:</para>

<itemizedlist>
<listitem><para>Create VMs, edit VM properties, and delete VMs.</para></listitem>
<listitem><para>Set up networking.</para></listitem>
<listitem><para>Control the power saving functions of VMs and the device as a whole.</para></listitem>
<listitem><para>Manage &PB; device settings, including authentication, touchpad sensitivity and speed, and &BC; wallpaper.</para></listitem>
<listitem><para>Manage USB devices.</para></listitem>

</itemizedlist>
<note><para>If the Measured Launch feature has not been enabled, a message box appears:</para>
	<mediaobject>
		<imageobject>
			<imagedata align="left" fileref="images/msg_measured_launch_not_enabled.png" width="3.5in" />
		</imageobject>
	</mediaobject>
<para>Click <guilabel>Continue</guilabel> to clear the message.</para>
</note>

<note><para>If one or more VMs have been set to start automatically on device startup, you can return to &BRAND_CONSOLE; by either:</para>
<itemizedlist>
<listitem><para>Pressing <keycap>Ctrl + 0</keycap>.</para></listitem>
<listitem><para>Clicking <guilabel>Home</guilabel> in the switcher bar located in the middle of the top of the VM display.</para></listitem>
</itemizedlist>

</note>
<para><olink targetdoc="XTEngineAdministratorGuide" targetptr="iovm_first_boot" /> shows &PB; as it appears before any VMs are installed.</para>
   
   <figure id="iovm_first_boot"><title>&BC; With No VMs Installed</title>
   <mediaobject>
     <imageobject>
      <imagedata align="left" fileref="images/host-after_first_boot.png" width="5.5in" />
     </imageobject>
    </mediaobject>
</figure>
<bridgehead>Legend for <olink targetdoc="XTEngineAdministratorGuide" targetptr="iovm_first_boot" /></bridgehead>

<orderedlist>
	<listitem><para><emphasis role="bold">Power</emphasis> Provides power controls for the device and the VMs running on it, allowing you to shut down, sleep, hibernate and restart &PB; and all the VMs running on it.</para></listitem>
	
	<listitem><para><emphasis role="bold">Install VM</emphasis> Click here to create a new VM. When no VM has yet been installed, there is also a <guilabel>Install VM</guilabel> icon in the center of the main window.</para></listitem>
	
	<listitem><para><emphasis role="bold">Info</emphasis> Click here to open the <guilabel>Information</guilabel> window. In this window you can see information about the software version, the hardware components and the network interfaces present. You can also generate status reports from this window.</para>
	</listitem>
	
	<listitem><para><emphasis role="bold">Services</emphasis> Click here to open the <guilabel>Services</guilabel> window. In this window you can see a list of the service VMs present on the host. By default, there is a Network service VM present on the system after installation. In this window you can control many of the properties of your &PB; device.</para>
	</listitem>
	
	
	<listitem><para><emphasis role="bold">Settings</emphasis> Click here to open the <guilabel>Settings</guilabel> window. In this window you can control many of the properties of your &PB; device.</para>
	</listitem>
		
	<listitem><para><emphasis role="bold">Network</emphasis> Click here to set up wired and wireless networking for your &PB; device. You can control which networks each VM has access to by editing the VM properties.</para></listitem>
	
	<listitem><para>An <emphasis role="bold">XT Measured Launch icon</emphasis> displays the status of the <emphasis>Measured Launch</emphasis> security settings.</para></listitem>
		
	<listitem><para>A <emphasis role="bold">Battery Power Gauge</emphasis> shows how much power is left in the case of a laptop running on battery power.</para></listitem>
		
	</orderedlist>
		
	<section id="host_services"><title>&PB; Services</title>
<para>The <guilabel>Services</guilabel> window lists the service VMs that are present on the system. By default, there is a Network service VM present on the system after installation. There are a number of general settings for service VMs that can be changed by clicking the <guilabel>Edit</guilabel> button to the right of a service VM in the list.</para>
<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/services.png" width="3in" />
	</imageobject>
</mediaobject>

<para>The properties shown by clicking <guilabel>Edit</guilabel> are the same as the properties available in the <guilabel>VM Details</guilabel> dialog that allows you to view and modify user VM properties. See <olink targetdoc="XTEngineAdministratorGuide" targetptr="vm_details" /> for details.</para> 

</section>
	
<section id="host_settings"><title>&PB; Settings</title>
<para>There are a number of general settings for the &PB; device that can be changed from the <guilabel>Settings</guilabel> dialog box.</para>

<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/settings-software_update.png" width="4in" />
	</imageobject>
</mediaobject>

<itemizedlist>
	<listitem>
		<para><guilabel>Wallpaper</guilabel> allows you to choose a background image to use as wallpaper for the &BC;.</para>
	</listitem>
	
	<listitem>
		<para><guilabel>Input Devices</guilabel> allows you to choose a <guilabel>Keyboard Layout</guilabel>, enable or disable <guilabel>Touchpad Options</guilabel> (Tap to Click and Scrolling), adjust the <guilabel>Touchpad Speed</guilabel>, and choose whether or not there is a <guilabel>Mouse Pointer Trail</guilabel>.</para>
	</listitem>
	
	<listitem>
		<para><guilabel>Display</guilabel> allows you to adjust the <guilabel>Screen Brightness</guilabel>, and to enable <guilabel>Screen Lock Settings</guilabel>.</para>
	</listitem>
	
	<listitem>
		<para><guilabel>Sleep</guilabel> allows you to define how the &PB; system and the VMs running on it orchestrate how it will sleep. Under <guilabel>System sleep</guilabel>, you can choose what happens to the system given that any running VMs are asleep. The choices are <guilabel>Do not put the system to sleep</guilabel> or <guilabel>Put the entire system to sleep after <emphasis>x</emphasis> minutes</guilabel>, where <emphasis>x</emphasis> is a number of minutes that you specify. Under <guilabel>When the lid closes</guilabel>, you can choose to either <guilabel>Put the entire system to sleep</guilabel> (VMs and all) or <guilabel>Do not put anything to sleep</guilabel>, separately for when the system is on AC power or on battery power.</para>
	</listitem>
	
	<listitem>
		<para><guilabel>Software Update</guilabel> allows you to view the current version and build of the &PB; software and the Tools CD version, and allows you to provide a URL and check there for newer versions of the software.</para>
	</listitem>
	
	<listitem>
		<para><guilabel>Local Password</guilabel> allows you to set a password to enable local authentication.</para>
	</listitem>
</itemizedlist>

</section>
	
<section id="installing_vms"><title>Creating VMs on &PB;<indexterm><primary>VMs</primary><secondary>Installing</secondary></indexterm>
<indexterm><primary>VMs</primary><secondary>Creating</secondary></indexterm>
<indexterm><primary>VMs</primary><secondary>Supported operating systems</secondary></indexterm>
<indexterm><primary>Creating VMs</primary></indexterm>
<indexterm><primary>Installing VMs</primary></indexterm></title>

<para><indexterm><primary>Operating systems, supported, for VMs</primary></indexterm>
<indexterm><primary>Supported operating systems for VMs</primary></indexterm>You can create VMs on &PB; by using operating system installation media. The following operating systems are supported:</para>
<itemizedlist>
	<listitem><para><emphasis>Microsoft Windows</emphasis></para>
		<itemizedlist>
			<listitem><para>Windows XP SP3 32-bit</para></listitem>
			<!-- <listitem><para>Windows Vista SP2 32-bit</para></listitem> -->
			<listitem><para>Windows 7 SP1 32-bit</para></listitem>
			<listitem><para> Windows 7 SP1 64-bit</para></listitem>
			<listitem><para>Windows 8</para></listitem>
		</itemizedlist>
	</listitem>
	
	<listitem><para><emphasis>Linux</emphasis></para>
		<itemizedlist>
			<listitem><para>Ubuntu 11.04 32-bit</para></listitem>
			<listitem><para>Ubuntu 12.04 32-bit</para></listitem>
			<listitem><para>Ubuntu 12.10 32-bit</para></listitem>
			<listitem><para>Ubuntu 13.04 32-bit</para></listitem>
			<listitem><para>Ubuntu 13.10 32-bit</para></listitem>
			</itemizedlist>
	</listitem>
</itemizedlist>
<important><para>The Ubuntu Unity desktop manager is not supported by &PB;. Please use an alternative desktop manager. For example:</para>
<screen>apt-get install lubuntu-desktop</screen>
</important>

<para>There are three main steps to creating a VM on &PB;:</para>
<itemizedlist>
	<listitem>
		<para>Create the VM, specifying:</para>
		<itemizedlist>
			<listitem><para>a name</para></listitem>
			<listitem><para>an optional description</para></listitem>
			<listitem><para>which template it will use</para></listitem>
			<listitem><para>how much virtual memory and how many virtual CPUs it will have</para></listitem>
			<listitem><para>how much disk space it will use</para></listitem>
			<listitem><para>the type of network it will be on</para></listitem>
		</itemizedlist>
	</listitem>
		
	<listitem>
		<para>Install a supported operating system on the VM.</para>
	</listitem>
		
	<listitem>
		<para>Install the &PV_TOOLS; on the VM.</para>
	</listitem>
</itemizedlist>

<para>Once these steps have been completed, you can optionally enable &HDX; for this VM. Only one running VM can benefit from &HDX; technology.</para>

<section id="installing_vms_from_install_disk"><title>Creating VMs from an Installation Disk</title>

<note>
<itemizedlist>
<listitem><para>If you are installing from an external optical drive that was connected to your &PB; device when &PB; booted, please unplug the optical drive and plug it in again before continuing.</para></listitem>
<listitem><para>Installation using an external optical media device is not supported if your device has an internal optical media drive.</para></listitem>
<listitem><para>&PB; only supports operating systems installed on the primary partition.</para></listitem>
<listitem><para>When installing a second VM from an installation disk, shut down the VM you installed first. Otherwise, the first VM continues to own the physical optical media drive, and the second VM will therefore fail to see the drive and will be unable to boot into the installer.</para></listitem>
</itemizedlist>
</note>

<procedure id="create_from_cd"><title>To Create a VM Using an Installation Disc</title>
<step><para>Click <guilabel>Add VM</guilabel> and choose <guilabel>Install from Disc</guilabel>. The <guilabel>Create from Install Disc</guilabel> wizard opens with the <guilabel>Name &amp; Template</guilabel> page displayed.</para>
<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/create_vm_from_install_disk_wizard-name_template.png" width="4in" />
	</imageobject>
</mediaobject>
<para>Enter a <guilabel>VM Name</guilabel> and an optional <guilabel>Description</guilabel>, if desired. Select the operating system template from the <guilabel>Template</guilabel> dropdown list. The choices are:</para>
<itemizedlist>
	<listitem><para>Windows 8</para></listitem>
	<listitem><para>Windows (7, XP)</para></listitem>
	<listitem><para>Linux (Debian, Ubuntu)</para></listitem>
</itemizedlist>	
</step>
<step><para>Click the <guilabel>Next</guilabel> button. The <guilabel>Icon</guilabel> page is displayed.</para>
<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/create_vm_from_install_disk_wizard-icon.png" width="4in" />
	</imageobject>
</mediaobject>
<para>Select an icon to represent the VM.</para>
</step>
<step><para>Click the <guilabel>Next</guilabel> button. The <guilabel>Memory &amp; CPUs</guilabel> page is displayed.</para>
<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/create_vm_from_install_disk_wizard-memory_cpus.png" width="4in" />
	</imageobject>
</mediaobject>
<para>Specify the amount of <guilabel>Memory</guilabel> to assign to the VM. (The total amount of memory and the available free memory on the device are displayed below.)</para>
<para>Choose the number of <guilabel>vCPUs</guilabel> (virtual CPUs) to assign to the VM from the dropdown list.</para>
</step>
<step><para>Click the <guilabel>Next</guilabel> button. The <guilabel>Storage &amp; Networking</guilabel> page is displayed.</para>
<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/create_vm_from_install_disk_wizard-storage_networking.png" width="4in" />
	</imageobject>
</mediaobject>
<para>Specify the <guilabel>Virtual Disk Size</guilabel> to assign to the VM (the default is 80 GB).</para>
<para>Select from the choices available for <guilabel>Disk Encryption</guilabel> - <emphasis>AES-256</emphasis> (the default), <emphasis>AES-128</emphasis>, or <emphasis>None</emphasis>.<indexterm><primary>Disk encryption</primary></indexterm><indexterm><primary>Encryption, disk</primary></indexterm></para>
<para>Select the <guilabel>Wired Network</guilabel>  mode. The options are:</para>
<itemizedlist>
	<listitem><para><emphasis>Internal</emphasis> which only allows for network communication between VMs.</para></listitem>
	<listitem><para><emphasis>Bridged</emphasis> (the default), which gives the VM full access to the networks that the &PB; host computer is connected to.</para></listitem>
	<listitem><para><emphasis>Shared</emphasis> which creates a private network on the &PB; system and allows outgoing connections using NAT (Network Address Translation). This reuses a single IP address for all VMs on the system. In this case incoming connections to the VM are not possible.</para></listitem>
</itemizedlist>
<note><para>Bridged mode requires that each virtual NIC is appropriately configured. Either the physical network will have to provide DHCP to allow the interface to establish an IP address and associated configuration, or you will need to statically configure the network settings on that interface from within the VM.</para></note>
<para>Select the <guilabel>Wireless Network</guilabel> mode. The options depend on what wireless devices are present on the system. On a laptop with a standard wireless interface and a mobile wireless interface, for example, the choices would be:</para>
<itemizedlist>
<listitem><para><emphasis>Shared Wireless</emphasis>, which gives the VM full access to the wireless network(s) that the &PB; host device is connected to using a wireless network card.</para></listitem>
<listitem><para><emphasis>Shared 3G</emphasis>, which gives the VM access to any 3G networks that the &PB; host device is connected to.</para></listitem>
</itemizedlist>
</step>

<step><para>Click the <guilabel>Next</guilabel> button. The <guilabel>Finish</guilabel> page is displayed.</para>
<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/create_vm_from_install_disk_wizard-finish.png" width="4in" />
	</imageobject>
</mediaobject>
<para>By default, <guilabel>Start VM &amp; Install OS</guilabel> is selected. If you would prefer to install the operating system at a later time, select the <guilabel>Create VM &amp; Install OS later</guilabel> radio button.</para>
<warning>
	<itemizedlist>
		<listitem>
			<para>If you are using a Windows installation disk that originated from a OEM supplier, do <emphasis>not</emphasis> start the VM automatically - be sure to select the <guilabel>Create VM &amp; Install OS later</guilabel> radio button. You will first need to enable OEM installation for the VM so that system properties are presented in a manner that allows the OEM installation disk to verify that it is being installed on genuine hardware. See <xref linkend="enable_oem_install" /> for information about how to do this.</para>
		</listitem>
	</itemizedlist>	
	
	<itemizedlist>
		<listitem>
			<para>For Ubuntu version 12.10, do <emphasis>not</emphasis> start the VM automatically - be sure to select the <guilabel>Create VM &amp; Install OS later</guilabel> radio button. There an error in the kernel in this release of Ubuntu that prevents installation of it on a VM unless you follow <xref linkend="proc_ubuntu_12.10_installation_hack" />.</para>
		</listitem>
	</itemizedlist>
</warning>
			
</step>

<step><para>Click the <guilabel>Finish</guilabel> button. The VM will be created according to your specifications.</para>
<note><para>If you selected disk encryption while creating the VM, a message may appear requesting you to move the mouse to generate entropy to be used in the encryption process.</para></note>
<para>If you selected <guilabel>Start VM &amp; Install OS</guilabel> above, the &PB; display switches to the VM display and you can perform the installation. If you selected <guilabel>Create VM &amp; Install OS later</guilabel> above, the display will return to the &BC;, where you will see an icon representing the new VM.</para>
</step>
</procedure>

<para>Now that you have created a new VM, the next step is to install an operating system on it as described in <xref linkend="install_os" />.</para>

</section>

<section id="installing_os_on_vms"><title>Installing an Operating System on a VM</title>

<procedure id="install_os"><title>To Install an Operating System onto a VM</title>
<step><para>Insert the installation media into the optical media drive. For a network boot installation, skip to the next step.</para>
</step>
<step><para>Start the VM if it is not already started. The new VM takes focus and begins to boot into the operating system installation procedure. For a network boot, press <keycap>F12</keycap> (or the relevant key) and select the appropriate boot device.</para><note><para>For security reasons the optical media drive is only accessible from one VM at a time. If a VM is running that has the optical drive assigned to it, it is necessary to shut down that VM before you can boot into the operating system installation medium.</para></note></step>
<step><para>Complete the operating system installation as you would do on a physical machine.</para>
<note><para>&COMPANY_NAME_SHORT; recommends not enabling automatic Windows updates until you have installed the &PV_TOOLS;.</para></note></step>

<step><para><indexterm><primary>&PV_TOOLS;</primary>
<secondary>installing</secondary></indexterm>When installation is complete, install the &PV_TOOLS; as described in the next section.</para>

<para>For an Ubuntu VM (with the exception of Ubuntu 12.10), first update the operating system software, and then install the &PV_TOOLS; as described in the next section.</para>
</step>

<step><para>For a Windows VM, run Windows Update.</para></step>
 
<step><para>Once the installation is complete and updates have been installed you can press <keycap>Ctrl + 0</keycap> to return to &BC;</para></step>

</procedure>

<procedure id="enable_oem_install"><title>To Enable VM Installation from OEM Installation Media</title>
	<para>If you are installing Windows from an OEM version of the Windows installation media, use this procedure to enable OEM installation:</para>
	&view_details;
	<step>
		<para>Click the <guilabel>Advanced</guilabel> menu item.</para>
	</step>

	<step>
		<para>From the <guilabel>Allow OEM Windows installs</guilabel> dropdown list, select <guilabel>Enabled</guilabel>.</para>
	</step>
	
	<step>
		<para>Click <guilabel>Save</guilabel>.</para>
	</step>
	
	<step>
		<para><!-- TODO: check -->Restart &PB;. When &PB; has restarted, start the VM and continue with the standard VM installation procedure.</para>
	</step>

</procedure>

<procedure id="proc_ubuntu_12.10_installation_hack"><title>To Install Ubuntu 12.10 onto a VM</title>
	<step>
		<para>Follow the normal procedure using the <guilabel>Create from Install Disk</guilabel> wizard with the  <guilabel>Linux (Debian, Ubuntu)</guilabel> template up to the final step, and choose <guilabel>Create VM &amp; Install OS later</guilabel> before clicking <guilabel>Finish</guilabel>.</para>
	</step>
	
	<step>
		<para>&OPEN_CONSOLE;</para>
	</step>

	<step>
		<para>Run the following command:</para>
		<screen>xec-vm -n <replaceable>ubuntu_12.10_VM_name</replaceable> set xci-cpuid-signature false</screen>
	</step>
	
	<step>
		<para>Close the console, and start the VM with the ISO in the optical drive. Follow the prompts to install the operating system.</para>
		<note><para>You will not be able to install the &PV_TOOLS; until you update the kernel.</para></note>
	</step>
					
	<step>
		<para>Update the kernel in the standard manner.</para>
	</step>
					
	<step>
		<para>Shut down the VM.</para>
	</step>
						
	<step>
		<para>&OPEN_CONSOLE;</para>
	</step>
						
	<step>
		<para>Run the following command:</para>
		<screen>xec-vm -n <replaceable>ubuntu 12.10 VM name</replaceable> set xci-cpuid-signature true</screen>
	</step>
	
	<step>
		<para>Close the console, and start the VM.</para>
	</step>
						
	<step>
		<para>Install &PV_TOOLS; in the usual manner as described in <xref linkend="proc_installing_pvtools_linux" />.</para>
	</step>
</procedure>

</section>

<section id="install_pv_tools"><title>Installing the &PB; Tools</title>

<para>After VM installation is complete, there is the additional step of installing the &PV_TOOLS; on it before it can be used. The &PV_TOOLS; include high performance virtualization-aware drivers, and the &PB; Switcher Bar to allow switching between the VMs using a mouse. Additionally, because &PRODUCT_BRAND; uses a network driver service VM, there is no network connectivity available until the &PV_TOOLS; (which include the network PV driver) have been installed in the VM.</para>
<warning><para>Running a VM without &PV_TOOLS; installed is <emphasis role="bold">not</emphasis> a supported configuration. VMs without the &PV_TOOLS; yet installed are indicated with a warning icon <inlinemediaobject><imageobject><imagedata fileref="images/tools-not-installed-warning-icon.png"></imagedata></imageobject></inlinemediaobject> in &BC;.</para></warning>

<warning><para>Installation of any software that uses low-level drivers to monitor disk operations before installing the &PV_TOOLS; (for example, antivirus software) will result in problems when hibernating, rebooting, or shutting down the VM. The installation of the &PV_TOOLS; is required for a VM to properly run on &PB;.</para></warning>
<note><para><indexterm><primary>VMs</primary><secondary>stub domain</secondary></indexterm><indexterm><primary>Stub domain</primary></indexterm>If you intend to create a stub domain on this VM to host its ioemu process, note that this must be done before installing the &PV_TOOLS;. See <olink targetdoc="XTEngineAdministratorGuide" targetptr="using_stubdoms" />.</para></note>

<procedure><title><indexterm><primary>&PV_TOOLS;</primary><secondary>Installing on Windows 8 or Windows 7 VM</secondary></indexterm>To Install the &PV_TOOLS; on a Windows 8 or Windows 7 VM</title>
<step><para>Select <guilabel>Computer</guilabel> from the <guilabel>Start</guilabel> menu, or press <keycap>Win + E</keycap>.</para></step>
<step><para>Select the optical drive from the displayed storage devices, which is usually mapped as the <filename>E:</filename> drive.</para></step>
<step><para>Run <filename>setup.exe</filename> from the disk, accept the license agreement, and follow the prompts.</para>
<note><para>The &PV_TOOLS; require Windows .NET 4. If the VM has an earlier version of .NET, the &PV_TOOLS; installer will perform this setup first before installing the drivers.</para></note>
</step>
<step><para>Reboot the VM to complete the tools installation.</para></step>
</procedure>

<procedure><title><indexterm><primary>&PV_TOOLS;</primary><secondary>Installing on Windows XP VM</secondary></indexterm>To Install the &PV_TOOLS; on a Windows XP VM</title>
<para>The &PV_TOOLS; installer requires Microsoft .NET, which is not included in Windows XP. For this reason, on a Windows XP VM, the &PV_TOOLS; are installed in two stages: basic paravirtualized drivers are installed first, followed by the remaining tools.</para>

<note><para>This section is only relevant if a stub domain is not enabled on the VM. See <xref linkend="using_stubdoms" /></para></note>

<step><para>Connect the &PB; device to a wired network with Internet access (to allow the .NET download).</para></step>
<step><para>Use &BC; to install a Windows XP VM from physical vendor media.</para></step>
<step><para>In the Windows XP VM, select the Tools CD and navigate to the <guilabel>Packages</guilabel> directory.</para></step>
<step><para>Run <filename>xensetup.exe</filename> to install the paravirtualized I/O drivers.</para></step>
<step><para>Reboot the VM and follow prompts to install PV devices.</para></step>
<step><para>Confirm network connectivity from VM to off-host IP address.</para></step>
<step><para>In Windows XP VM, run the Tools CD.</para></step>
<step><para>Choose <guilabel>Install &PB; Tools</guilabel>; this will automatically download .NET.</para></step>
<step><para>Reboot the VM.</para></step>
</procedure>

<procedure id="proc_installing_pvtools_linux"><title><indexterm><primary>&PV_TOOLS;</primary><secondary>Installing on Linux VM</secondary></indexterm>To Install the &PV_TOOLS; on a Linux VM</title>
<note><para>Do not install the &PV_TOOLS; on Linux using <command>dpkg</command> directly, nor by double-clicking on the package via the graphical desktop.</para></note>
<step><para>At a command line shell on the VM, change users to become the superuser:</para>
<screen>sudo su</screen>
</step>
<step><para>Display the available drives with the command</para>
<screen>df -k</screen>
<para> and observe the name of the optical drive with the &PV_TOOLS;; it will be something like <filename>/media/XenClient-tools-<replaceable>version number</replaceable></filename>.</para></step>
<step><para>Change to the <filename>linux</filename> directory on the optical drive with the &PB; Tools package:</para>
<screen>cd /media/XenClient-tools-<replaceable>version number</replaceable>/linux</screen>
</step>
<step><para>Run the <filename>install.sh</filename> script:</para>
<screen>./install.sh</screen>
</step>
<step><para>Reboot the VM.</para>
<note><para>The &BC; will show the tools as installed, but a reboot is required to properly complete the Tools installation.</para></note></step>
</procedure>

<note><para>Ubuntu versions 11.04 and 12.04 exhibit issues with 3D Graphics. For these operating systems, please follow the &PB; Tools installation above and the following procedure.</para></note>

<procedure><title>To Install a PVM-capable Intel Graphics Driver On a Ubuntu 11.04 or 12.04 VM</title>

<note>
<para>Do not install the &PV_TOOLS; on Linux using <command>dpkg</command> directly, nor by double-clicking on the package via the graphical desktop.</para>
<para>Note that for this procedure:</para>
<itemizedlist>
<listitem><para>an internet connection is required</para></listitem>
<listitem><para>the script must be executed as root</para></listitem>
<listitem><para>the script will download 100 MB of kernel source files in order to build a new Linux graphics driver</para></listitem>
</itemizedlist>
</note>

<step><para>At a command line shell on the VM, change users to become the superuser:</para>
<screen>sudo su</screen>
</step>
<step><para>Display the available drives with the command</para>
<screen>df -k</screen>
<para> and observe the name of the optical drive with the &PV_TOOLS;; it will be something like <filename>/media/XenClient-tools-<replaceable>version number</replaceable></filename>.</para></step>
<step><para>Change to the <filename>linux</filename> directory on the optical drive with the &PB; Tools package:</para>
<screen>cd /media/XenClient-tools-<replaceable>version number</replaceable>/linux</screen>
</step>
<step><para>Run the <filename>fix-i915-passthrough.sh</filename> script:</para>
<screen>./fix-i915-passthrough.sh</screen>
</step>
<step><para>Reboot the VM.</para></step>
</procedure>

<!--
<procedure><title>To Install a VM from &BACKEND;<indexterm><primary>VMs</primary>
<secondary>installing from &BACKEND;</secondary></indexterm></title>

<step><para>Ensure that you are connected to your &BACKEND; server. See <olink targetdoc="XenClientSetupAndUsageGuide" targetptr="registering_with_backend" /> for information about how to connect.</para></step>
<step><para>In &BC;, click <guilabel>Add VM</guilabel> and choose <guilabel>Download From &BACKEND;</guilabel>.</para></step>
<step><para>If you have not recently securely authenticated with &BACKEND; you are prompted to provide your password.</para>
</step>
<step><para>The <guilabel>Download from &BACKEND;</guilabel> wizard is displayed.</para></step>
<step><para>Click the <guilabel>Select a new VM</guilabel> radio button if you want to create a new VM, or the <guilabel>Restore VM from backup</guilabel> radio button to create a new VM from a VM backup.</para></step>
 
<step><para>For a new VM, click the VM you want to install. For a new VM from backup, select the VM and the VM backup version.</para></step>

<step><para>Click <guilabel>Finish</guilabel>.</para></step>

<step><para>Wait for the VM to download to &PB;. You can check the download progress in &BC; by switching to VM detail view.</para>

</step>
</procedure>
-->
</section>
</section>

				<section id="networking"><title>Configuring Networks for the &PB; Device</title><para><indexterm><primary>Networking</primary><secondary>configuring</secondary></indexterm>&PB; device networks can be used by all VMs installed on the &PB; device. Each individual VM can be configured to allow or disallow access to the configured networks. Use the &BC; Network Manager to configure your &PB; device networks. See <olink targetdoc="XenClientSetupAndUsageGuide" targetptr="using_bc" /> for more information about &BC;.</para>
			   
					<procedure><title>To Configure a Wired Network Connection for &PB;<indexterm><primary>Networking</primary><secondary>wired connection setup</secondary></indexterm><indexterm><primary>Wired networking setup</primary></indexterm></title><para>A wired connection is automatically created if the computer is plugged in to a network. To confirm that a wired connection exists:</para>
<step><para>In &BC;, click the <guilabel>Network</guilabel> button. A list of available and already connected network connections is displayed.</para></step>
<step><para>Ensure that the <guilabel>Wired Ethernet Connection</guilabel> entry is not labeled as disconnected and grayed out.</para></step>
					</procedure>

					
					<procedure><title>To Configure a Static IP Address for &PB;<indexterm><primary>Networking</primary><secondary>static IP address</secondary></indexterm></title>
					<step><para>In &BC;, click on the <guilabel>Network</guilabel> button and select <guilabel>Edit Connections...</guilabel>. The <guilabel>Network Connections</guilabel> dialog is displayed. Wired and wireless networks are listed in their own page, selected by the tabs at the top of the dialog.</para>
					 <mediaobject>
							<imageobject>
								<imagedata align="left" fileref="../public/images/host_network-network_connections.png" width="3.5in" />
							</imageobject>
					</mediaobject>
					</step>
					<step><para>Select the network to edit and click the <guilabel>Edit</guilabel> button. The <guilabel>Editing <replaceable>network_name</replaceable></guilabel> dialog is displayed.</para></step>
	
<step><para>Click the <guilabel>IPv4 Settings</guilabel> tab.</para></step>

<step><para>Select <guilabel>Manual</guilabel> from the <guilabel>Method</guilabel> dropdown list.</para></step>

<step><para>Click the <guilabel>Add</guilabel> button to the right of the <guilabel>Addresses</guilabel> section.</para></step>

<step><para>Click in the <guilabel>Address</guilabel> field and enter the desired static IP address.</para></step>					
<step><para>Click in the <guilabel>Netmask</guilabel> field and enter the desired netmask.</para></step>	
<step><para>Click in the <guilabel>Gateway</guilabel> field and enter the desired gateway address.</para></step>	
<step><para>Below the <guilabel>Addresses</guilabel> section, click in the <guilabel>DNS servers</guilabel> text box and enter the desired DNS server address.</para></step>
<step><para>Click in the <guilabel>Search domains</guilabel> text box and enter the desired DNS server address.</para></step>	

<step><para>Click the <guilabel>Save...</guilabel> button.</para></step>	

	</procedure>
					
	<procedure>
    <title>To Configure a Wireless Network Connection for &PB;<indexterm><primary>Networking</primary><secondary>wireless connection setup</secondary></indexterm><indexterm><primary>Wireless connection setup</primary></indexterm></title>
<step><para>In &BC;, click the <guilabel>Network</guilabel> button.</para></step>
    <step><para>Choose your preferred wireless network from the list and enter your security credentials when prompted.</para></step>
    
<!--    <step><para>To use wireless networks you will be ask to enter your own preferred security profile password. This profile password will protect all the wireless network credentials that you enter on &PB; from unauthorized access, and you will need to re-enter this password to connect to secure networks on subsequent reboots. You can optionally leave the password fields blank in which case the wireless credentials will not be protected.</para></step> -->
    
   </procedure>
   
<procedure><title>To Import a Certificate for Use in Wireless Network Authentication<indexterm><primary>Networking</primary><secondary>wireless authentication certificate, importing</secondary></indexterm><indexterm><primary>Importing wireless authentication certificate</primary></indexterm></title>
<step><para>&OPEN_CONSOLE;</para></step>   

<step><para>Switch roles to the sysadm_r role as follows:</para>   
<screen>newrole -r sysadm_r</screen></step>

<step><para>Run the following command to determine the IP address of the control domain:</para>
<screen>ifconfig</screen>
<para>The relevant IP address is the one for <literal>eth0</literal>.</para>
</step>


<!--
<step><para>Before copying files to the control domain filesystem, run the following commands to enter the SELinux admnistrative role, temporarily disable SELinux enforcement, and set the filesystem to read/write:</para>
<screen>nr
setenforce 0
rw</screen>
</step>
-->

<step><para>Create the directory <filename>/config/certs/<replaceable>ndvm-name</replaceable></filename>:</para>
<screen>mkdir -p /config/certs/<replaceable>ndvm-name</replaceable></screen>
</step>

<step><para>If there is only one NDVM (Network VM), copy the certificates to the <filename>/config/certs/Network</filename> directory using the control domain IP address. For example:</para>
<screen>scp company.ca.cer root@10.80.249.175:/config/certs/Network</screen>
<para>If there are multiple NDVMs and you need to make the certificates available to another NDVM (not the one named <emphasis>Network</emphasis>), you need to run the following command:</para>
<screen>xec-vm -n <replaceable>ndvm-name</replaceable> set icbinn-path /config/certs/<replaceable>ndvm-name</replaceable></screen>
<para>and then copy the certificates to the <filename>/config/certs/<replaceable>ndvm-name</replaceable></filename> directory using the control domain IP address. For example:</para>
<screen>scp company.ca.cer root@10.80.249.175:/config/certs/<replaceable>ndvm-name</replaceable></screen>
<para>On Windows you could use PSCP, the PuTTY Secure Copy client, or WinSCP to transfer the certificates to the control domain.</para>
</step>

<!--
<step><para>When you have completed copying the certificate, run the following commands to re-enable SELinux and reset the filesystem back to read only:</para>
<screen>setenforce 1
ro</screen>
</step>
-->

<step><para>Close the console.</para></step>
<step><para>Reboot the &PB; device.</para></step>
<step><para>In &BC;, click the <guilabel>Network</guilabel> button (or, if you have multiple NDVMs, click the desired NDVM button). From the bottom of the menu, select <guilabel>Edit Connections</guilabel> to display the <guilabel>Network Connections</guilabel> dialog box.</para></step>
<step><para>Click on the <guilabel>Wireless</guilabel> tab, select the network name, and click <guilabel>Edit</guilabel>.</para></step>
<step><para>In the dialog box that opens, select the <guilabel>Wireless Security</guilabel> tab and click on <guilabel>CA Certificate</guilabel> to display a browse dialog. Select the certificate and click <guilabel>Open</guilabel>, then click <guilabel>Save</guilabel> on the edit dialog, and finally click <guilabel>Close</guilabel> on the <guilabel>Network Connections</guilabel> dialog.</para></step>

<!--

<step><para>In the &BC; console, run the following command:</para>
<screen>scpv4v <replaceable>certificate_filename</replaceable> uivm:/root/.gconf</screen>
<para>You will now be able to enter the path to the certificate in Network Manager when connecting to your wireless network. The certificate will be available in <guilabel>/root/.gconf</guilabel>.</para></step>
-->

	</procedure>
   
   <procedure><title>To Change a VM MAC Address<indexterm><primary>VMs</primary><secondary>changing MAC address</secondary></indexterm></title>
		<step><para>&OPEN_CONSOLE;</para></step>   
		<step><para>Run the command:</para>
			<screen>xec-vm -n <replaceable>vm_name</replaceable> -c 0 set mac "<replaceable>new_mac_address</replaceable>"</screen>
		</step>
   </procedure>
   
	</section>
	<section id="switching_between_vms"><title>Switching Between VMs<indexterm><primary>VMs</primary>
<secondary>switching</secondary></indexterm></title>

<para>The &PB; switcher bar is displayed when you click the small black bar at the top center of your VM screen. You can use the switcher bar or one of the other methods listed below to switch between VMs.</para>
	
	<note><para>The switcher bar is installed when you install the &PV_TOOLS;. Note that it might not appear on the first boot after tools installation. If so, reboot the VM once more and the Switcher bar will be displayed.</para></note>
	
<para>To switch from &BC; to a VM, you can:</para>
<itemizedlist>
<listitem><para>Press <keycap>Ctrl + <replaceable>vm_switcher_key</replaceable></keycap>, for example, <keycap>Ctrl + 1</keycap>. This is known as the VM Switcher key. To return to &BC; at any time, press <keycap>Ctrl + 0</keycap>.</para></listitem>
<listitem><para>Click on a VM icon.</para></listitem>
<listitem><para>Click the <guilabel>Switch</guilabel> button near the top left of a VM's <guilabel>Details</guilabel> dialog.</para></listitem>
</itemizedlist>


<para>To switch between VMs, you can:</para>
<itemizedlist>
<listitem><para>Use VM Switcher keys.</para></listitem>
<listitem><para>Click on a VM icon in the Switcher bar. You can also click <guilabel>Home</guilabel> to return to &BC;.</para></listitem>
<listitem><para>Press <keycap>Windows Key + Alt</keycap> to cycle through all running VMs, in a manner similar to the way <keycap>Alt + Tab</keycap> switches between Windows applications.</para></listitem>
</itemizedlist>


<note><para>The ability to switch between VMs is disabled when a VM with &HDX; enabled is booting, shutting down, or when logging in to it. This includes when Windows is installing updates before shutting down. See <olink targetdoc="XenClientSetupAndUsageGuide" targetptr="hdx" /> for more information about &HDX;.</para></note>

</section>

<section id="vm_details"><title>VM Details<indexterm><primary>VMs</primary>
<secondary>details</secondary></indexterm></title>
<para>&BC; provides a simple, intuitive interface that you use to install VMs, start and stop VMs, and edit their properties.</para>

<para>The following figure shows the &BC; interface with three VMs installed on it. Running VMs are labeled <guilabel>On</guilabel> and shut down VMs are labeled <guilabel>Off</guilabel>. If you hover your mouse pointer over a VM icon, it increases in size and presents you with a power switch icon (either  <guilabel>Shut Down</guilabel> for a running VM or <guilabel>Start</guilabel> for a shut down VM), and a button labeled <guilabel>Details</guilabel>.</para>
<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/uivm_vm_icons.png" width="4.5in" />
    </imageobject>
</mediaobject>
<para>To access VM options, hover your mouse over a VM icon, then click the <guilabel>Details</guilabel> button. The <guilabel>VM Details</guilabel> window is displayed.</para>
<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/vm_details.png" width="4in" />
	</imageobject>
</mediaobject>
<para>The buttons along the top left of the window depend on whether the VM is currently running or not. If it is, you can <guilabel>Switch</guilabel> to the VM's display from the &BC;, or <guilabel>Shut Down</guilabel>, <guilabel>Reboot</guilabel>, <guilabel>Sleep</guilabel> or <guilabel>Hibernate</guilabel> the VM.</para>
	
<para>On the top right are buttons to <emphasis role="bold">Add USB Device</emphasis> and to <emphasis role="bold">Delete</emphasis> the VM. The latter is greyed out and unavailable unless the VM is shut down.</para>
	
<para>On the left side below the power buttons are links that open the various views of the VM's details:</para>
	

	<itemizedlist>
		<listitem><para><emphasis role="bold">General</emphasis> contains the a text box with VM <guilabel>Name</guilabel>; a pull-down list of available key combinations you can select as the <guilabel>Switcher Key</guilabel> for this VM; a pull-down list of operating systems you can select as the <guilabel>Type</guilabel> for this VM; a control, <guilabel>Show VM in Switcher Bar</guilabel>, that enables whether or not this VM will be displayed in the Switcher Bar; another control, <guilabel>Seamless Application Support</guilabel>, that enables or disables support for Seamless Applications; and a  editable <guilabel>Description</guilabel>.</para></listitem>
		
		<listitem><para><emphasis role="bold">Hardware</emphasis> allows you to view and edit various hardware settings, such as the number of <guilabel>vCPUs</guilabel>; the amount of <guilabel>Memory (MB)</guilabel>; whether <guilabel>3D Graphics</guilabel> is enabled or disabled for this VM; a control to select whether the &PV_TOOLS; are present in the <guilabel>Virtual CD</guilabel> drive; the <guilabel>Guest Tools Version</guilabel>; a control to select the <guilabel>Wireless Network</guilabel>; a control to set the <guilabel>Wired Network</guilabel>; and <guilabel>Wired MAC Address</guilabel>.</para></listitem>
		
		<listitem><para><indexterm><primary>VMs</primary><secondary>disk persistence</secondary></indexterm><indexterm><primary>Disk persistence</primary></indexterm><indexterm><primary>Persistence, disk</primary></indexterm><emphasis role="bold">Disks</emphasis> allows you to view and edit the virtual disks for this VM. For each disk, you can enable or disable Persistence (which controls whether or not changes to the disk data persist across reboots). You can also <guilabel>Delete</guilabel> a disk, and you can <guilabel>Add</guilabel> a new disk. The latter two are greyed out and unavailable unless the VM is shut down.</para></listitem>
		
		<listitem><para><emphasis role="bold">Power</emphasis> allows you to enable <guilabel>Autoboot</guilabel>, which causes the VM to be started automatically when you start your &PB; device; <guilabel>Power Control</guilabel>, which enables you to specify whether or not the host will hibernate, sleep, or shut down when the VM does; and a control to add or delete boot devices and specify the <guilabel>Boot Order</guilabel>.</para></listitem>
		
		<listitem><para><emphasis role="bold">Icon</emphasis> allows you to select a VM icon to be used to represent it in &BC;.</para></listitem>
	
		<listitem><para><emphasis role="bold">USB Devices</emphasis> allows you to see the USB devices currently assigned to this VM. You can choose whether each device is always used with this VM via the <guilabel>Always Use With This VM</guilabel> checkbox. You can also choose whether or not any free USB devices will be automatically assigned to this VM via the <guilabel>Auto-assign USB Devices</guilabel> control.</para></listitem>
		
		<listitem><para><emphasis role="bold">PCI Pass Through</emphasis> allows you to pass through any of the PCI devices (for example, the USB controllers) to the VM. If any devices are already listed, you can <guilabel>Stop</guilabel> passing them through. These are greyed out and unavailable unless the VM is shut down.</para>
		<note><para>If you assign a USB controller to a VM using PCI Pass Through, you need to reboot the system before you can use devices attached to that controller. Likewise if you unassign a PCI devices a reboot is required before it will be available to be assigned elsewhere.</para></note> 
		<caution><para>This section is for advanced features that should only be modified if you understand their impact on the system.</para></caution>
		</listitem>

		<listitem><para><emphasis role="bold">Advanced</emphasis> allows you to change advanced VM features. These are grouped into</para>
			<itemizedlist>
				<listitem><para><guilabel>Isolation Policies</guilabel>, which includes enabling or disabling the VM's use of a <guilabel>Stub Domain</guilabel>, <guilabel>Wired Network Access</guilabel>, <guilabel>Wireless Network Access</guilabel>, <guilabel>CD Reading</guilabel>, <guilabel>CD Writing</guilabel>, <guilabel>Audio Playback</guilabel>, and <guilabel>Audio Recording</guilabel>.</para></listitem>
				<listitem><para><guilabel>Hardware Compatibility</guilabel>, which includes enabling or disabling whether or not to <guilabel>Allow OEM Windows Install</guilabel>, <guilabel>Expose Physical Hardware Information</guilabel>, <guilabel>Expose Physical OEM Hardware</guilabel> and <guilabel>Intel AMT Passthrough</guilabel></para></listitem>
				<listitem><para><guilabel>Virtual Compatibility</guilabel>, which allows you to enable or disable whether or not to <guilabel>Emulate Microsoft Hyper-V</guilabel>, enable or disable if this VM is a <guilabel>Hardware Virtual Machine</guilabel>, and allows you to set the values for certain advanced parameters of the system: <guilabel>Kernel Path</guilabel>, <guilabel>Kernel Extraction Path</guilabel>, <guilabel>Command Line</guilabel>, and <guilabel>Initial Ramdisk</guilabel>.</para></listitem>
			</itemizedlist>
		<caution><para>This section is for advanced features that should only be modified if you understand their impact on the system.</para></caution></listitem>
	</itemizedlist>
	
</section>

<section id="vm_networking"><title>VM Networks</title>
<para><indexterm><primary>VMs</primary><secondary>networking</secondary></indexterm><indexterm><primary>Networking</primary><secondary>VMs</secondary></indexterm>&PB; device networks can be used by all VMs installed on the &PB; device. You use the &BC; Network Manager to configure your &PB; device networks. See <olink targetdoc="../XenClientSetupAndUsageGuide" targetptr="networking" /> for more information about the networks available to the &PB; device.</para>

<para>Each individual VM can be configured to allow or disallow access to the configured networks. This is done through each VM's <guilabel>Details</guilabel> dialog. Hover your mouse over a VM icon, then click the <guilabel>Details</guilabel> button. The <guilabel>Details</guilabel> window is displayed. Click <guilabel>Networks</guilabel> to display the current networks this VM has access to. You can click the <guilabel>Remove</guilabel> button to the right of a network to remove it.</para>

<note><para>Making changes on the Networks tab is not allowed until the &PB; Tools have been installed and the VM has been shut down.</para></note>


<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/vm_details-networks.png" width="4in" />
	</imageobject>
</mediaobject>

<para>To add another network, click the <guilabel>Add Network</guilabel> button. The <guilabel>Add a Network</guilabel> dialog opens:</para>

<mediaobject>
	<imageobject>
		<imagedata align="left" fileref="images/vm_details-networks-add_network.png" width="3in" />
	</imageobject>
</mediaobject>

<para>This dialog allows you to see all the networks available to the &PB; device and allows you to select any of them to add to the VM.</para>

<para>For more information about &PB; networking see <olink targetdoc="XTEngineAdministratorGuide" targetptr="networking_configuration" />.</para>

</section>

<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="vm_power_controls" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="working_with_vms" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="hdx" xmlns:xi="http://www.w3.org/2001/XInclude" />

<!--
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="portica" xmlns:xi="http://www.w3.org/2001/XInclude" />
-->

</chapter>

<chapter id="vm_configuration"><title>VM Configuration and Lockdown Policy</title>
<note><para>Changes to a VM's policy require a reboot of the VM to take effect.</para></note>
<section><title>Configuring a &HDX; VM With an Nvidia or ATI GPU</title>
<procedure><title>To Enable &HDX; on a VM with Direct Access to the GPU Video Hardware</title>
 <step><para>Install all VM software updates, ensure that the &PV_TOOLS; are installed, and confirm working network connectivity.</para></step>
 <step><para>Shutdown the VM.</para></step>
&view_details;
 <step><para>Click the <guilabel>Hardware</guilabel> tab.</para></step>
 
 <step><para>From the <guilabel>3D Graphics Support</guilabel> dropdown list, select the GPU you want to assign to the VM and click <guilabel>Save</guilabel>.</para></step>
 <step><para>Start the VM. Do not use the automated Windows driver install functionality for the newly detected GPU.</para></step>
 <step><para>If the GPU is a ATI GPU, deactivate it before installing the driver:</para>
<substeps><!-- TODO: clean up -->
  <step><para>Open Device Manager.</para></step>
  <step><para>Under Display Adaptors, identify the ATI device.</para></step>
  <step><para>Right click on the ATI device and select Disable.</para></step>
  <step><para>Reboot the VM.</para></step>
</substeps>
  </step>

 <step><para>Download and install the Windows XP Nvidia Quadro Driver 259.12 or later (Nvidia GPU) or the Catalyst driver 10.9 or later (ATI GPUs).</para></step>
  <step><para>Do <emphasis>not</emphasis> reboot when prompted by the Nvidia or ATI driver installation.</para></step>
 <step><para>Open Windows XP Device Manager.</para></step>

  <step><para>Select <guilabel>Display Adapters &gt; Citrix Xen Display Driver</guilabel>.</para></step>
  <step><para>Right-click on the device and select <guilabel>Disable</guilabel>.</para></step>
  <step><para>Confirm that the device should be disabled.</para></step>
  <step><para>Accept the prompt to restart the device.</para></step>
  <step><para>After the VM restarts, the VM boot screen will be shown on the Intel display, but the desktop (after boot) will be shown on the Nvidia or ATI display.</para></step>

</procedure>
</section>
<section><title>Configuring Audio Device Assignment</title>

<para><indexterm><primary>VMs</primary><secondary>audio device assignment</secondary></indexterm>
<indexterm><primary>VMs</primary><secondary>disabling audio recording</secondary></indexterm>
Use the following procedure to prevent a VM from recording audio.</para>
<procedure><title>To Disable Audio Recording from a VM</title>
<!--
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the following command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-audio-recording false</screen></step>
<step><para>Reboot the VM.</para></step>
-->
<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>Advanced</guilabel>.</para></step>
<step><para>On the right side, under <guilabel>Isolation Policies</guilabel>, select <guilabel>Disabled</guilabel> for  <guilabel>Audio Recording</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>If the VM is running, reboot it for the change to take effect.</para></step>
</procedure>

<note>
	<para>By default, there is no detection of HDMI and DP audio devices if they are present, and therefore no audio output from them.</para>
	
	<para>HDMI audio output will work only if the HDA audio controller PCI device controlling the HDMI connector is passed through to the VM. In case of an Nvidia/AMD adapter, there is always a different HDA device controlling the HDMI sound output on the card.</para>

	<para>A good way of using the HDMI connector would be to pass trough the Nvidia/AMD HDA PCI device to the VM. In this case we could have, for example, shared sound across all VMs provided by the standard Intel integrated HDA adapter (native speakers, headphones, mic.) and a fully passed-through HDA Nvidia/AMD adapter (HDMI connector on the discrete card) to one single VM. The HDA Nvidia/AMD adapter can be passed through to a different VM without needing to reboot the host platform.</para>
</note>


<para><indexterm><primary>VMs</primary><secondary>audio device assignment</secondary></indexterm>Use the following procedure to enable VT-d passthrough of the host audio device to a single VM. This functionality can only be used for a single VM. After you enable this for one VM, you need to disable audio playback for the remaining VMs.</para>

<procedure><title>To Enable Audio Device Assignment to One VM</title>
<!--
<para>This command enables VT-d passthrough of the audio device to a single VM.</para> 
<para>After dedicating the audio device to a single VM, remove audio emulation from the remaining VMs.</para>
<note><para>A reboot of the &PB; platform is required after passthrough rule changes.</para></note>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Shut down all the VMs on the system.</para></step>
<step><para>Add a rule to give this device to the VM:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> add-pt-rule 0x0403 any any</screen></step>
<step><para>Check that the device that will be assigned to the VM is the correct one:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> list-pt-pci-devices</screen></step>
<step><para>Reboot the &PB; device, then restart the VMs.</para></step>
<step><para>On the VM to which you assigned the audio device, uninstall the Citrix Audio Driver in the Windows Control Panel under <guilabel>Sound, video and game controllers</guilabel> using Device Manager to avoid potential conflicts between that driver and the hardware-specific driver.</para></step>
<step><para>On the same VM, install the appropriate audio driver and then reboot the VM to complete the driver installation.</para></step>
-->

<step><para>Shut down the desired VM.</para></step>
<step><para>In &BRAND_CONSOLE; open the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>PCI Pass Through</guilabel>.</para></step>
<step><para>Select the Audio Controller from the list of devices, then click <guilabel>Pass Through</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>Start the VM.</para></step>
<step><para>Open Device Manager and ensure that there is no problem reported with the audio device.</para></step>
</procedure>

<!--
<procedure><title>To Remove Audio Emulation from a VM</title>
<para>Follow this procedure to remove audio emulation from the remaining VMs.</para>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the following command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-audio-access false</screen></step>
<step><para>Boot the VM.</para></step>
<step><para>Repeat this procedure for the remaining VMs.</para></step>
</procedure>
-->
</section>

<section><title>Configuring Optical Disk Policies</title>

<procedure><title>To Disable Writing to an Optical Disk for a VM</title>
<!--
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the following command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-cd-recording false</screen></step>
<step><para>Reboot the VM.</para></step>
-->
<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>Advanced</guilabel>.</para></step>
<step><para>On the right side, under <guilabel>Isolation Policies</guilabel>, select <guilabel>Disabled</guilabel> for  <guilabel>CD Reading</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>If the VM is running, reboot it for the change to take effect.</para></step>
</procedure>

<procedure><title>To Disable Write Access to an Optical Disk for a VM</title>
<!--
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the following command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-cd-access false</screen></step>
<step><para>Reboot the VM.</para></step>
-->
<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>Advanced</guilabel>.</para></step>
<step><para>On the right side, under <guilabel>Isolation Policies</guilabel>, select <guilabel>Disabled</guilabel> for  <guilabel>CD Writing</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>If the VM is running, reboot it for the change to take effect.</para></step>

</procedure>
<note><para>These settings only affect the internal CD/DVD drive. USB drives are not affected.</para></note>
</section>

<section id="using_stubdoms"><title>Using Stub Domains</title>
<para><indexterm><primary>VMs</primary><secondary>stub domain</secondary></indexterm><indexterm><primary>Stub domain</primary></indexterm>A VM can be set up to use a stub domain to host its <literal>ioemu</literal> process. This has the advantage of the <literal>ioemu</literal> process being behind the single Xen scheduler without also being behind the Linux scheduler in the control domain, and also provides an additional level of security for the control domain.</para>

<note><para>Ensure that stub domains are enabled before installing the &PV_TOOLS; inside the VM. Stub domains are enabled by default.</para></note>

<procedure><title>To Enable a Stub Domain for a VM</title>
<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>Advanced</guilabel>.</para></step>
<step><para>On the right side, under <guilabel>Isolation Policies</guilabel>, select <guilabel>Enabled</guilabel> for  <guilabel>Stub Domain</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>If the VM is running, reboot it for the change to take effect.</para></step>
</procedure>
<!--
<para>The following command enables the stub domain feature on a VM:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set stubdom true</screen>
<para>The same command with "false" instead of "true" disables the feature. The VM has to be off when changing the stubdom parameter value.</para>
-->

<note><para>If you want to add disks to a stub domain, only device nodes <literal>sd[a-h]</literal> and <literal>hd[a-h]</literal> with the maximum number of partitions are supported.</para></note>

</section>

<section><title>Enabling USB Controller Assignment to One VM</title>
<procedure><title><indexterm><primary>VMs</primary><secondary>assigning USB controller to a single VM</secondary></indexterm>To Assign a USB Controller to a Single VM</title>

<step><para>Shut down the desired VM.</para></step>
<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>PCI Pass Through</guilabel>.</para></step>
<step><para>On the right side, click on <guilabel>Pass Through PCI Device</guilabel>. A dialog box appears.</para></step>
<step><para>Select the desired USB Controller from the list of devices, then click <guilabel>Pass Through</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>Start the VM.</para></step>
<step><para>Open Device Manager and ensure that there is no problem reported with the Universal Serial Bus controllers.</para></step>
<step><para>Press <keycap>Ctrl+0</keycap> to switch back to &BC;.</para></step>
<step><para>Plug a USB device into one of the USB ports assigned to the VM.</para></step>
<step><para>Select the <guilabel>Details</guilabel> dialog for the VM. On the left side, select <guilabel>USB Devices</guilabel>. Check that the device is listed.</para></step>
<step><para>Switch back to the VM. The USB device should be present.</para></step>
</procedure>

<para>On some models of supported hardware, USB devices may share the same USB bus. In this case all USB devices on the specified bus will be passed through to the VM.</para>

</section>

<!--
<section><title>Prevent use of Print Screen key inside all VMs</title>
<para>Press Ctrl-Shift-T in the UIVM to obtain a dom0 console window.</para>
<screen>db-write /print-screen-disallowed true</screen>
</section>
-->

<section><title>Networking Policy Settings</title>

<procedure><title>To Prevent Use of Wired Networking Inside a Specific VM</title>
<!--
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-wired-networking false</screen></step>
<step><para>Reboot the VM.</para></step>
-->
<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>Advanced</guilabel>.</para></step>
<step><para>On the right side, under <guilabel>Isolation Policies</guilabel>, select <guilabel>Disabled</guilabel> for  <guilabel>Wired Network Access</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>If the VM is running, reboot it for the change to take effect.</para></step>
</procedure>

<procedure><title>To Prevent Use of Wireless Networking Inside a Specific VM</title>
<!--
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-wireless-networking false</screen></step>
<step><para>Reboot the VM.</para></step>
-->

<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>Advanced</guilabel>.</para></step>
<step><para>On the right side, under <guilabel>Isolation Policies</guilabel>, select <guilabel>Disabled</guilabel> for  <guilabel>Wireless Network Access</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>If the VM is running, reboot it for the change to take effect.</para></step>
</procedure>
</section>

<section><title>VM Property Editing Policy Settings<indexterm><primary>Policy settings, VMs</primary></indexterm><indexterm><primary>VMs</primary><secondary>policy settings</secondary></indexterm></title>

<procedure><title>To Allow or Disallow Editing of VM Properties</title>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>To disable the ability to modify VM settings, run the command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-modify-vm-settings false</screen>
<para>or, to enable it:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> -i com.citrix.xenclient.xenmgr.vm.unrestricted set policy-modify-vm-settings \
true</screen></step>
<step><para>Reboot the VM.</para></step>
</procedure>

<!--
<procedure><title>To Disable VM Installation</title>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>To hide the Install VM buttons, run the command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-create-vm false</screen>
<para>or, to enable it:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> -i com.citrix.xenclient.xenmgr.vm.unrestricted set policy-create-vm true</screen></step>
<step><para>Reboot the VM.</para></step>
</procedure>
-->

<!--
<procedure><title>To Disable VM Deletion</title>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>To hide the Delete VM buttons, run the command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-delete-vm false</screen>
<para>or, to enable it:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> -i com.citrix.xenclient.xenmgr.vm.unrestricted set policy-delete-vm true</screen></step>
<step><para>Reboot the VM.</para></step>
</procedure>
-->

<!--
<procedure><title>To Disable Updates</title>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>To hide the </guilabel>Software Update</guilabel> tab in the <guilabel>Settings</guilabel> dialog, run the command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set ota-upgrades-allowed false</screen>
<para>or, to enable it:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> -i com.citrix.xenclient.xenmgr.vm.unrestricted set ota-upgrades-allowed true</screen></step>
<step><para>Reboot the VM.</para></step>
</procedure>
-->

<procedure id="proc-disable_advanced_per_vm"><title>To Disable Advanced and PCI Pass Through Settings for VMs</title>
<para>This procedure allows you to prevent modification of the <guilabel>Advanced</guilabel> and <guilabel>PCI Pass Through</guilabel> settings from the VM <guilabel>Details</guilabel> for a specific VM. You can also set this for <emphasis>any</emphasis> VMs on this &PB; host; see <olink targetdoc="XTEngineAdministratorGuide" targetptr="proc-disable_advanced_all_vms" /> for details.</para>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>To hide <guilabel>Advanced</guilabel> and <guilabel>PCI Pass Through</guilabel> tabs on the VM <guilabel>Details</guilabel> dialog, run the command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy_modify_vm_advanced false</screen>
<para>or, to enable it:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> -i com.citrix.xenclient.xenmgr.vm.unrestricted set policy_modify_vm_advanced \
true</screen></step>
<step><para>Reboot the VM.</para></step>
</procedure>

<procedure><title>To Prevent Use of the Print Screen Key Inside a Specific VM</title>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> set policy-print-screen false</screen></step>
<step><para>Reboot the VM.</para></step>
</procedure>

</section>

</chapter>

<chapter id="platform_configuration"><title>Platform Configuration</title>

<section><title>Enabling Control Domain Network Access</title>
<para>In &PB; the Network Driver Virtual Machine (NDVM) provides network connectivity to other VMs. By default the control domain does not have network access.</para>

<procedure><title>To Enable Control Domain Network Access</title>

<note><para>The IP address of the wired connection as displayed in the <guilabel>Connection Information</guilabel> box in &BC; is not the IP address of the hypervisor control domain. Instead, it displays the IP address of the <indexterm><primary>Networking</primary><secondary>Network Driver Domain VM (NDVM)</secondary></indexterm>Network Driver Domain service VM (NDVM). If you have enabled ssh, open a terminal from the &BC;, log in, and run the command <command>ifconfig</command> to obtain the IP address of <literal>eth0</literal>. Use this IP address to ssh to the control domain.</para></note>

<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the following commands:</para>
<screen>xec set enable-ssh true
reboot</screen>
</step>
</procedure>

<procedure><title>To Disable Control Domain Network Access</title>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the following commands:</para>
<screen>xec set enable-ssh false
reboot</screen>
</step>
</procedure>

</section>

<section id="vm_disk_persistence"><title>VM Disk Persistence</title>
<para><indexterm><primary>VMs</primary><secondary>disk persistence</secondary></indexterm>
		<indexterm><primary>Disk persistence</primary></indexterm>
		<indexterm><primary>Persistence, disk</primary></indexterm>This setting determines whether or not changes to the data on a disk remain after the VM is rebooted.</para>
<note><para>Please ensure that you have installed the &PV_TOOLS; in the VM and performed all VM configuration before disabling persistence for disks.</para></note>
<procedure><title>To Disable VM Disk Persistence</title>
<!--
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the following command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> -disk <replaceable>diskid</replaceable> set snapshot temporary</screen>
</step>
-->
<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>Disks</guilabel>.</para></step>
<step><para>On the right side, under <guilabel>Persistence</guilabel>, select <guilabel>Disabled</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>If the VM is running, reboot it for the change to take effect.</para></step>

</procedure>
<note><para>Some Windows registry keys, specifically those related to Active Directory (AD), are maintained and not reset.</para></note>

<procedure><title>To Enable Disk Persistence</title>
<!--
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>To revert back to non-reset behavior, run the following command:</para>
<screen>xec-vm -n <replaceable>vm_name</replaceable> -disk <replaceable>diskid</replaceable> set snapshot none</screen>
</step>
-->
<step><para>In &BRAND_CONSOLE; select the <guilabel>Details</guilabel> dialog for the desired VM.</para></step>
<step><para>On the left side, select <guilabel>Disks</guilabel>.</para></step>
<step><para>On the right side, under <guilabel>Persistence</guilabel>, select <guilabel>Disabled</guilabel>.</para></step>
<step><para>Click <guilabel>Save</guilabel>, and close the dialog.</para></step>
<step><para>If the VM is running, reboot it for the change to take effect.</para></step>
</procedure>

<section id="service_vms-disk_read_only_mode_on_tapdisk_level"><title>Setting Read-only Mode for a Disk on the Tapdisk Level</title>
	<para><indexterm><primary>VMs</primary><secondary>setting read-only mode for a disk on the tapdisk level</secondary></indexterm>Although VMs can opt to use read-only filesystems just using their own logic, extra security can be achieved if read-only mode is toggled on the tapdisk level, so that it is actually guarded by the Control Domain.</para>
	
	<procedure id="proc-disk_readonly_mode"><title>To turn on read-only mode for a disk</title>
		<step><para>&OPEN_CONSOLE;</para></step>
		<step><para>Run the command:</para>
		<screen>xec-vm -n <replaceable>vm_name</replaceable> --disk <replaceable>disk-num</replaceable> set mode r</screen></step>
	</procedure>

	<procedure id="proc-disk_readwrite_mode"><title>To turn on read/write mode for a disk</title>
		<step><para>&OPEN_CONSOLE;</para></step>
		<step><para>Run the command:</para>
		<screen>xec-vm -n <replaceable>vm_name</replaceable> --disk <replaceable>disk-num</replaceable> set mode w</screen></step>
	</procedure>

</section>


</section>



<section><title>Enabling Mouse Switching Between VMs Pinned to Displays</title>
<para>If you have multiple graphics processors, &PB; supports running two separate VMs side by side, each on its own monitor. The mouse cursor can be dragged seamlessly from one VM to the other.</para>
<para>The settings to control this appear on the <guilabel>Settings</guilabel> dialog on the <guilabel>Display</guilabel> page if the system has two graphics processors.</para>

<mediaobject>
<imageobject>
<imagedata align="left" fileref="images/settings-display-with_multiple_display_adapters.png" width="4in" />
</imageobject>
</mediaobject>

<procedure><title>To control mouse switching between multiple VMs</title>
<step><para>In &BC;, click <guilabel>Settings</guilabel> to open the dialog box, then select <guilabel>Display</guilabel> .</para></step>
<step><para>If necessary, under <emphasis>Display Adapters</emphasis>, click one of the small arrows between the monitor icons to change their order relative to which adapter is connected to which monitor (left or right).</para></step>
<step><para>Under <emphasis>Mouse Switching</emphasis>, <guilabel>Mouse Switching</guilabel> is enabled, <guilabel>Keyboard Follows Mouse</guilabel> is disabled, and <guilabel>Switching Resistance</guilabel> is set to 2 by default. Use the pull-downs to change any of these settings as desired.</para></step>
<step><para>Click <guilabel>Save</guilabel>, then <guilabel>Close</guilabel>.</para></step>
</procedure>

<!--
<para><indexterm><primary>Mouse switching between dual-monitor VMs</primary></indexterm>To implement alternate physical layouts of the two displays, change the VM slot number (0, 1, 2, etc) and edge (left, right) definitions. The VM slot number (N) is the <keycap>Ctrl+<replaceable>N</replaceable></keycap> keyboard sequence used to switch the input context to that VM. The syntax of the command is <command>xec-vm -n <replaceable>vm_name</replaceable> set seamless-mouse-[left|right] <replaceable>slot_number</replaceable></command>. For example, to set the VM with switcher key 2 to move to switch to the VM with switcher key 3 when the mouse is moved over the right border of the screen, run the command:</para>
<screen>xec-vm -n <replaceable>name_of_vm_with_switcher_key_2</replaceable> set seamless-mouse-right 3</screen>

<para>The following example configuration implements switching for a display layout with:</para>
<itemizedlist>
 <listitem><para>4 non-HDX VMs (including UIVM) on the left monitor</para></listitem>
 <listitem><para>1 HDX VM (e.g. using Nvidia GPU) on the right monitor</para></listitem>
</itemizedlist>
<para>Press <keycap>Ctrl+Shift+t</keycap> in &BC; to obtain a control domain console window.</para>
<screen>db-write /switcher/self-switch-disabled ""
xec-vm -n <replaceable>vm1_name</replaceable> set seamless-mouse-left prev
xec-vm -n <replaceable>vm0_name</replaceable> set seamless-mouse-right 1
xec-vm -n <replaceable>vm2_name</replaceable> set seamless-mouse-right 1
xec-vm -n <replaceable>vm3_name</replaceable> set seamless-mouse-right 1
xec-vm -n <replaceable>vm4_name</replaceable> set seamless-mouse-right 1</screen>
<para>To remove a boundary switch, for example for <replaceable>vm2_name</replaceable>, set the <literal>seamless-mouse-right</literal> property to an empty string:</para>
<screen>xec-vm -n <replaceable>vm2_name</replaceable> set seamless-mouse-right ""</screen>
<para>To see the current state of the boundary switch for a VM, run the command using <literal>get</literal> instead of <literal>set</literal>:</para>
<screen>xec-vm -n <replaceable>vm0_name</replaceable> get seamless-mouse-right</screen>
<para>This command outputs the switcher key of the VM that the right boundary of <replaceable>vm0_name</replaceable> switches to.</para>
-->

<!-- <screen>xec-vm -n <replaceable>vm_name</replaceable> set seamless-mouse-left [ <replaceable>slot_number</replaceable> | prev ]</screen>
 -->
</section>


<section id="host_config-policies"><title>Platform Lockdown Policy Settings<indexterm><primary>Policy settings, &PB; host</primary></indexterm><indexterm><primary>&PB;</primary><secondary>policy settings</secondary></indexterm></title>

<para>This section lists policy settings that be used to modify the appearance and behavior of &BC; on a &PB; device.</para>

<informaltable>
<tgroup cols="3">
<colspec colwidth="1.5in" />
<colspec colwidth="2.5in" />
<colspec colwidth="*" />
<thead>
<row>
	<entry>Command</entry>
	<entry>Allows / Disallows</entry>
	<entry>Example</entry>
</row>
</thead>
<tbody>
<row>
	<entry>vm-creation-allowed</entry>
	<entry>VM Installation</entry>
	<entry>xec set vm-creation-allowed false</entry>
</row>
<row>
	<entry>connect-remote-desktop-allowed</entry>
	<entry>XenDesktop connection buttons</entry>
	<entry>xec set connect-remote-desktop-allowed true</entry>
</row>
<row>
	<entry>vm-deletion-allowed</entry>
	<entry>VM deletion</entry>
	<entry>xec set vm-deletion-allowed false</entry>
</row>
<row>
	<entry>ota-upgrades-allowed</entry>
	<entry>over-the-air upgrades</entry>
	<entry>xec set ota-upgrades-allowed false</entry>
</row>

<row>
	<entry>modify-settings</entry>
	<entry>modifying platform settings</entry>
	<entry>xec set modify-settings false</entry>
</row>
<row>
	<entry>modify-services</entry>
	<entry>modifying services</entry>
	<entry>xec set modify-services false</entry>
</row>
<row>
	<entry>modify-advanced-vm-settings</entry>
	<entry>modifying advanced VM settings</entry>
	<entry>xec set modify-advanced-vm-settings false</entry>
</row>



</tbody>
</tgroup>
</informaltable>

<procedure id="proc-disable_advanced_all_vms"><title>To Hide Advanced and PCI Pass Through Settings for All VMs</title>
<para>This procedure allows you to prevent modification of the <guilabel>Advanced</guilabel> and <guilabel>PCI Pass Through</guilabel> settings from the VM <guilabel>Details</guilabel> tab for <emphasis>any</emphasis> VM on the host. You can also set this for individual VMs; see <olink targetdoc="XTEngineAdministratorGuide" targetptr="proc-disable_advanced_per_vm" /> for details.</para>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>To hide the <guilabel>Advanced</guilabel> and <guilabel>PCI Pass Through</guilabel> sections from the VM <guilabel>Details</guilabel> tab for any VM on the host, run the command:</para>
<screen>xec policy-modify-vm-advanced false</screen>
<para>or, to show these sections:</para>
<screen>xec policy-modify-vm-advanced true</screen></step>
<step><para>Reboot the VM.</para></step>
</procedure>

</section>

</chapter>

<chapter id="networking_configuration"><title>Networking Configuration</title>

<para><indexterm><primary>Networking</primary><secondary>network service VM</secondary></indexterm>&PB; networking services are provided via a Network service VM called <emphasis>Network</emphasis>. You can view and modify this service VM via the <guilabel>Services</guilabel> button in &BC;.</para>

<section id="networking_config-nat-prefix"><title>Configuring Shared Networks</title>
<para><indexterm><primary>Networking</primary><secondary>configuring shared networks</secondary></indexterm>172.16.x.0/24 is the range of IP addresses used by &PB; for shared networks (wired, wifi, or internal networks). Any VMs on these networks will be assigned an IP from this range. If this range clashes with your deployed network setup or if for any other reason you want to use a different address range instead of the default one, this can be modified by running the following command:</para>
<screen>xec -s com.citrix.xenclient.networkdaemon -o <replaceable>network-object</replaceable> set nat-prefix <replaceable>subnet</replaceable></screen>
<para>For example if you run:</para>
<screen>xec -s com.citrix.xenclient.networkdaemon -o /wired/0/shared set nat-prefix 192.168.2.0</screen>
<para>shared networks will use the 192.168.2.0/24 subnet and the DHCP range will begin at 192.168.2.10.</para>

</section>
<section><title>Adding Internal Networks</title>
<para>By default an NDVM has a single internal network. This provides maximum isolation between internal networks. &COMPANY_NAME_SHORT; recommends this configuration for maximum security. Use the following procedure to create more internal networks per NDVM if desired.</para> 

<procedure><title>To add an additional internal network to an NDVM</title> 
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Assume the necessary roles and run the command:</para>
<screen>xec -s com.citrix.xenclient.networkdaemon create-network internal <replaceable>network-id</replaceable> "uuid=<replaceable>ndvm-uuid</replaceable>"</screen> 
<para>The parameters are:</para> 
<variablelist>
<varlistentry>
          <term>network-id</term>
          <listitem>
                <para>The number identifying the internal network. The network created will be assigned the identifier <literal>/internal/<replaceable>network-id</replaceable></literal>. This number can not be already assigned to other internal network.</para>
		</listitem>
</varlistentry>		
<varlistentry>
          <term>ndvm-uuid</term>
          <listitem>
                <para>UUID of the NDVM where the internal network will be created.</para>
		</listitem>
</varlistentry>		

  
</variablelist>
</step>
<step><para>Reboot to apply the changes.</para></step> 

</procedure>
</section>


<section id="networking_config-ndvm_firewall"><title>NDVM Firewall Configuration</title>

<para>NDVM firewalling is enabled for &PB;. However, the filtering is supported only on bridged networks. When a VM is on a bridged network, the following commands can be used to edit the firewall rules. The default behaviour is to accept all traffic to and from the VM. Any traffic that needs to be dropped needs to be added as a rule.</para>

<para>To list the firewall rules, run the command:</para>
<screen>xec-vm -n <replaceable>vm-name</replaceable> list-net-firewall-rules</screen>

<para>To add a firewall rule:</para>
<screen>xec-vm -n <replaceable>vm-name</replaceable> add-net-firewall-rule <replaceable>id</replaceable> <replaceable>direction</replaceable> <replaceable>remote-ip</replaceable> <replaceable>iptables-options</replaceable></screen>
<para>where:</para>
<itemizedlist>
	<listitem>
		<para><emphasis>id</emphasis> is the number indicating the order in which the rules should be run</para>
	</listitem>
	<listitem>
		<para><emphasis>direction</emphasis> - specifies in or out (filter for the VM's incoming/outgoing traffic)</para>
	</listitem>
	<listitem>
		<para><emphasis>remote-ip</emphasis> - is the IP address of the source or destination subnet when processing the in or out filter</para>
	</listitem>
	<listitem>
		<para><emphasis>extra</emphasis> - conatins any additional iptables flags</para>
	</listitem>
</itemizedlist>

<para>To delete a rule, run the command:</para>
<screen>xec-vm -n <replaceable>vm-name</replaceable> delete-net-firewall-rule <replaceable>id</replaceable></screen>

<para>For example, to drop all the traffic from a VM named <emphasis>win7</emphasis>, you could run the following:</para>

<screen>xec-vm -n win7 add-net-firewall-rule 1 "in" "0.0.0.0/0" ""
xec-vm -n win7 add-net-firewall-rule 2 "out" "0.0.0.0/0" ""</screen>

</section>

<section id="networking_config-multiple_ndvms"><title>Setting Up and Configuring Multiple NDVMs</title>
<para><indexterm><primary>Networking</primary><secondary>supporting multiple NDVMs</secondary></indexterm>By default the NDVM called <emphasis>Network</emphasis> has all the network PCI devices assigned to it. You might want to be able to run additional VMs, each connected to a different isolated network. This can be enabled by running one <indexterm><primary>Networking</primary><secondary>Network Driver Domain VM (NDVM)</secondary></indexterm><indexterm><primary>Multiple Network Driver Domain VMs (NDVMs)</primary></indexterm>Network Driver Domain VM (NDVM) per network.</para>

<para>Once a new NDVM has been added, it will appear in &BC; as an icon in the menu bar along the top, labeled with the NDVM's name, to the right of the default <emphasis>Network</emphasis> icon.</para>

<procedure id="proc_multiple_ndvms"><title>To create multiple NDVMs</title>
	<step><para>&OPEN_CONSOLE;</para></step>
	<step>
		<para>Any changes to the default NDVM's PCI rules will be reset on every system reboot. Therefore, before anything else, you need to make the NDVM settings persistent. To do so, run the following command:</para>
		<screen>db-write /xenmgr/overwrite-ndvm-settings false</screen>
	</step>
	
	<step>
		<para>To create a new NDVM, run the following command:</para>
		<screen>create-ndvm <replaceable>ndvm_name</replaceable></screen>
		<para>The NDVM that gets created will initially have no PCI devices assigned to it.</para>
	</step>
		
	<step>
		<para>The network devices are assigned to VMs using PCI rules. To list the PCI rules of an NDVM, use the command:</para>
		<screen>xec-vm -n <replaceable>ndvm_name</replaceable> list-pt-rules</screen>
	</step>
	
		<step>
		<para>Modify the NDVM pass through rules as follows:</para>
		<substeps>
		
			<step>
				<para>List the PCI pass through rules set on the default NDVM:</para>
				<screen>xec-vm -n Network list-pt-rules</screen>
				<para>This command lists the PCI rules that determines the type of PCI devices passed through to the NDVM. For example:</para>
				<screen>{ 
  "id"   = 0 
  "rule" = match class=0x0200 
}
{ 
  "id"   = 1 
  "rule" = match class=0x0280 
}</screen>
			</step>
			
			<step>
				<para>List all the PCI devices passed through to the default Network VM with the command:</para>
				<screen>xec-vm -n Network list-pt-pci-devices</screen>
				<para>This returns a list of all the PCI devices that are assigned to the Network VM. For example, running this command on the default Network VM will output something like the following:</para>
				<screen>{ 
  "addr"      = 0000:00:19.0 
  "class"     = 0x200 
  "device-id" = 0x1502 
  "name"      = Intel Corporation 82579LM Gigabit Network Connection 
  "vendor-id" = 0x8086 
}
{ 
  "addr"      = 0000:03:00.0 
  "class"     = 0x280 
  "device-id" = 0x85 
  "name"      = Intel Corporation Centrino Advanced-N 6205 
  "vendor-id" = 0x8086 
}</screen>
			</step>
		
			<step>
				<para>Next we want to create more specific rules for passing through PCI devices. To do this, first remove the class-based rule for wired networks from the default Network VM named <emphasis>Network</emphasis>:</para>
				<screen>xec-vm -n Network delete-pt-rule "0x200" "" ""</screen>
				<para>and then remove the class-based rule for wireless networks:</para>
				<screen>xec-vm -n Network delete-pt-rule "0x280" "" ""</screen>
				<note><para>You can add a specific device to the list with the command <command>xec-vm -n  <replaceable>ndvm_name</replaceable> add-pt-rule "<replaceable>class</replaceable>" "" ""</command>.</para></note>
			</step>
						

			<step>
				<para>To specifically assign one of these devices, create a pass through rule using the PCI BDF (Domain:Bus:Device.Function) format, specifying the listed <emphasis>addr</emphasis> value of the PCI device from the <command>list-pt-pci-devices</command> command above as follows:</para>
				<screen>xec-vm -n <replaceable>ndvm_name</replaceable> add-pt-rule-bdf <replaceable>addr_value</replaceable></screen>
				<note><para>By default, the Network VM has all network devices assigned to it using PCI <emphasis>class</emphasis> rules. The class-based rules are sufficient for most machines that have just one device of each class (for example, most laptops). But for machines that have more than one device of a specific class, PCI BDF (Domain:Bus:Device.Function) rules are used to assign and remove them.</para></note>
				<note><para>You can remove a specific device from the list with the command <command>xec-vm -n <replaceable>ndvm_name</replaceable> delete-pt-rule-bdf <replaceable>addr_value</replaceable></command>.</para></note>
			</step>
			
			<step>
				<para>To verify the changes you made, run the following command to list the rules:</para>
				<screen>xec-vm -n <replaceable>ndvm_name</replaceable> list-pt-rules</screen>
			</step>
			
		</substeps>
	</step>	
	
	<step>
		<para>Reboot the &PB; device.</para>
	</step>

</procedure>

<note><para>The control domain always uses the <emphasis>/wired/0/bridged</emphasis> network when there is a wired connection. This can be overwritten by running the command:</para>
<screen>db-write /networkdaemon/dom0/network <replaceable>network-id</replaceable></screen>
<para>Reboot the system for the control domain to start using the new network.</para>
</note> 

<procedure><title>To Change a Network Name</title>
<para>To change the network label, set the <literal>label</literal> property of the network object. This is the label used in the <guilabel>Networks</guilabel> tab of a VM in &BC;.</para>
<step><para>&OC;</para></step>
<step><para>Run the following command:</para>
<screen>xec -s com.citrix.xenclient.networkdaemon -o <replaceable>network-object</replaceable> set label <replaceable>network-label</replaceable></screen>

<para>For example:</para>
<screen>xec -s com.citrix.xenclient.networkdaemon -o /wired/0/bridged set label <replaceable>lab_network</replaceable></screen>
<note><para>Bridged and shared networks using the same physical interface (only possible with wired networks) use the same label. So in the above example <literal>/wired/0/bridged</literal> and <literal>wired/0/shared/</literal> will be identified by the label <guilabel>lab_network</guilabel>.</para></note>

</step>


</procedure>

<!--
<procedure id="proc_multiple_ndvms"><title>To create multiple NDVMs</title>
	<step>
		<para>Set the policy to modify VM settings to <emphasis>true</emphasis>:</para>
		<screen>xec-vm -o <replaceable>vm object</replaceable> -i com.citrix.xenclient.xenmgr.vm.unrestricted /
set policy-modify-vm-settings true
xec-vm -o <replaceable>vm object</replaceable> set name <replaceable>ndvm name</replaceable></screen>
	</step>

	<step>
		<para>Override the default settings for the default NDVM to allow changes to its configuration to be overwritten by running the following command:</para>
		<screen>db-write /xenmgr/overwrite-ndvm-settings false</screen>
	</step>

	<step>
		<para>Next, create a new NDVM using the NDVM template:</para>
		<screen>vm_reference = xec create-vm-with-template new-vm-ndvm
xec-vm -o ${vm_reference} set name <replaceable>new ndvm name</replaceable>
		</screen>

	</step>

	<step>
		<para>Modify the NDVM pass through rules as follows:</para>
		<substeps>
			<step>
				<para>List all the PCI devices passed through to an NDVM with the command:</para>
				<screen>xec-vm -n <replaceable>ndvm name</replaceable> list-pt-pci-devices</screen>
				<para>This returns a list of all the PCI devices that are assigned to the NDVM. For example, running this command on the default NDVM:</para>
				<screen>{ "addr" = 0000:00:19.0 "class" = 0x200 "device-id" = 0x1502 "name" = Intel Corporation 82579LM Gigabit Network Connection "vendor-id" = 0x8086 } { "addr" = 0000:03:00.0 "class" = 0x280 "device-id" = 0x85 "name" = Intel Corporation Centrino Advanced-N 6205 "vendor-id" = 0x8086 }</screen>
			</step>
		
			<step>
				<para>Next, list the PCI pass through rules set on the default NDVM:</para>
				<screen>xec-vm -n Network list-pt-rules</screen>
				<para>This command lists the PCI rules that determines the type of PCI devices passed through to the NDVM. For example:</para>
				<screen>{ "id" = 0 "rule" = match class=0x0200 } { "id" = 1 "rule" = match class=0x0280 }</screen>
			</step>
		
			<step>
				<para>Next we want to create more specific rules for passing through PCI devices. To do this, first remove the class-based rule for wired networks:</para>
				<screen>xec-vm -n Network delete-pt-rule "0x200" "" ""</screen>
				<para>and then remove the class base rule for wireless networks:</para>
				<screen>xec-vm -n Network delete-pt-rule "0x280" "" ""</screen>
			</step>
						
			<step>
				<para>List the details of the PCI devices passed through to the default NDVM:</para>
				<screen>xec-vm -n Network list-pt-pci-devices</screen>
			</step>
		
			<step>
				<para>To specifically assign one of these devices, create a pass through rule using the PCI BDF (Bus:Device.Function) format, which specifies the listed addr value of the PCI device:</para>
				<screen>xec-vm -n Network add-pt-rule-bdf <replaceable>addr value</replaceable></screen>
			</step>
			
			<step>
				<para>To see the changes, you can list the rules using</para>
				<screen>xec-vm -n <replaceable>ndvm name</replaceable> list-pt-rules</screen>
			</step>
			
		</substeps>
	</step>	

	<step>
		<para>Reboot the &PB; device.</para>
	</step>
	
	<step>
		<para>Finally, the new NDVM you created needs to have a swap VHD created. Start the NDVM, and in its consoles, run the command:</para>
		<screen>mkswap</screen>
	</step>
</procedure>
--> 



</section>

<section id="networking_config-transparent_bridging"><title>Transparent Bridging</title>

<para>By default, when a &PB; device is connected to a wired network, the Network VM requests an IP address on the network. If a VM is configured to use shared networking, the NDVM uses this IP address as the source address when performing NAT (Network Address Translation) on outgoing connections from the VM.</para>

<para>If no VMs are configured to use shared networking, the NDVM can instead be set up as a transparent bridge. In this mode, the NDVM does not request an IP address on the wired network, but still provides VMs that use bridged networking with full access to the wired network.</para>

<para>When multiple NDVMs are in use, this mode can be configured separately for each Network VM.</para>

<note>
        <para>When transparent bridging is enabled, &BC; will display the network icon for the Network VM as disconnected, and the options to configure the network interfaces will be disabled.</para>
</note>

<procedure id="proc_enable_transparent_bridging">
        <title>To enable transparent bridging for a Network VM</title>
        <step>
                <para>&OPEN_CONSOLE;</para>
        </step>
        <step>
                <para>Enter the command:</para>
                <screen>newrole -r sysadm_r</screen>
                <para>and provide the password.</para>
        </step>
        <step>
                <para>Enter the command:</para>
                <screen>xec-vm -n <replaceable>ndvm_name</replaceable> set-domstore-key transparent-bridging true</screen>
        </step>
        <step>
                <para>Reboot the &PB; device.</para>
        </step>
</procedure>

<procedure id="proc_disable_transparent_bridging">
        <title>To disable transparent bridging for a Network VM</title>
        <step>
                <para>&OPEN_CONSOLE;</para>
        </step>
        <step>
                <para>Enter the command:</para>
                <screen>newrole -r sysadm_r</screen>
                <para>and provide the password.</para>
        </step>
        <step>
                <para>Enter the command:</para>
                <screen>xec-vm -n <replaceable>ndvm_name</replaceable> set-domstore-key transparent-bridging false</screen>
        </step>
        <step>
                <para>Reboot the &PB; device.</para>
        </step>
</procedure>

</section>

<section id="networking_config-v4v_firewall"><title>V4V Firewall Configuration</title>

<para><indexterm><primary>Networking</primary><secondary>V4V firewall configuration</secondary></indexterm><indexterm><primary>V4V</primary><secondary>firewall configuration</secondary></indexterm><indexterm><primary>Firewall configuration, V4V</primary></indexterm>V4V firewall rules are specified as part of a VM's configuration. This is accomplished using the <command>add-v4v-firewall-rule</command> command from the command line console on the &PB; device:</para>

<screen>xec-vm -n <replaceable>vm_name</replaceable> add-v4v-firewall-rule <replaceable>rule</replaceable></screen>

<para>Firewall rules are instantiated when the VM is started and removed when it is shut down.</para>

<para>&COMPANY_NAME_SHORT; recommends to not use the Linux <command>viptables</command> command directly except for debugging purposes.</para>


</section>

<section id="networking_config-guest_802.1x_authentication"><title>Support for 802.1x Authentication in VMs (experimental)</title>
<para><indexterm><primary>Networking</primary><secondary>support for 802.1x authentication in VMs</secondary></indexterm><indexterm><primary>802.1x authentication in VMs, support for</primary></indexterm>Normal packet flow with 802.1x packets disappear in the <indexterm><primary>Networking</primary><secondary>Network Driver Domain VM (NDVM)</secondary></indexterm>Network Driver Domain VM (NDVM). This is due to the default behavior of the Linux bridging code, which drops packets from the MAC group which contain 802.1x.</para>
<para>&PB; includes a simple Linux kernel patch that allows for selective control of this behavior on a per-bridge basis.</para>
<note><para>Currently this capability is experimental only.</para></note>
<para>This capability is disabled by default. You can verify this for a bridge by reading the state of the <filename>break_8021d</filename> file as follows:</para>
<screen>cat /sys/devices/virtual/net/brbridged/bridge/break_8021d</screen>
<para>The output of the command will be <literal>0</literal> if 802.1x guest authentication is disabled, <literal>1</literal> if it is enabled.</para>
<note><para>As always, you must be in the <literal>sysadm_r role</literal> to effect these sorts of changes. You must also be in the NDVM, as that's where the bridge for wired network traffic resides. Therefore, since your ssh session will begin in the control domain, you'll need to be in the <literal>sysadm_r</literal> role in both the control domain and the NDVM before you can change the relevant settings.</para></note>
<procedure id="proc_enable_802.1x_authentication"><title>To enable 802.1x authentication in a user VM</title>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Run the command:</para>
<screen>newrole -r sysadm_r</screen>
<para>and provide the password.</para></step>
<step><para>SSH to the NDVM:</para>
<screen>sshv4v network</screen></step>
<step><para>Again, enter the command:</para>
<screen>newrole -r sysadm_r</screen>
<para>and provide the password.</para></step>
<step><para>Enable 802.1x authentication with the following command:</para>
<screen>echo 1 > /sys/devices/virtual/net/brbridged/brige/break_8021d</screen>
</step>
</procedure>

<procedure id="proc_disable_802.1x_authentication"><title>To disable 802.1x authentication in a user VM</title>

<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Enter the command:</para>
<screen>newrole -r sysadm_r</screen>
<para>and provide the password.</para></step>
<step><para>SSH to the NDVM:</para>
<screen>sshv4v network</screen></step>
<step><para>Again, enter the command:</para>
<screen>newrole -r sysadm_r</screen>
<para>and provide the password.</para></step>
<step><para>Run the follow command to disable 802.1x authentication:</para>
<screen>echo 0 > /sys/devices/virtual/net/brbridged/brige/break_8021d</screen>
</step>
</procedure>

</section>
</chapter>



<chapter>

<title>Other Administrative Tasks</title>

<section><title>Password Handling</title>

<para>To change the root user password for &PB;, open a command prompt (<keycap>Ctrl+Shift+t</keycap>), and run the following commands:</para>
<screen>echo -n "<replaceable>OLD_PASSWORD</replaceable>" > /tmp/oldpass
echo -n "<replaceable>NEW_PASSWORD</replaceable>" > /tmp/newpass
sec-change-root-credentials /tmp/newpass /tmp/oldpass</screen>

<para>Changes made to the configuration partition cause the system to prompt for the passphrase set in the TPM setup process. Run the following command to change this passphrase if required:</para>
<screen>openssl rsa -des3 -in /boot/system/install/data/recovery-private-key.conf \
-passin stdin -out /boot/system/install/data/recovery-private-key.conf \
-passout stdin</screen>
<para>Enter the old passphrase and press <keycap>Enter</keycap>. Then enter the new passphrase and press <keycap>Enter</keycap>. The following output is written to the console:</para> 
<screen>writing RSA key</screen>
</section> 

<!--
<section><title>Database Access Control</title>
<para>You can access the control domain database using <command>db-*-dom0</command> commands in the NILFVM. This can be useful for creating persistent data, for example VPN certificates, in a secure location in the control domain. To be able to do database requests, you have to add the corresponding rules in <filename>/etc/rpc-proxy.rules</filename> on the control domain file system. For example to allow read access from a VM with the UUID <literal>00000000-0000-0000-0000-000000000003</literal>:</para>
<screen>echo "allow dom-uuid 00000000-0000-0000-0000-000000000003 \
destination org.freedesktop.DBus interface \
org.freedesktop.DBus" >> /etc/rpc-proxy.rules

echo "allow dom-uuid 00000000-0000-0000-0000-000000000003 \
destination com.citrix.xenclient.db \
interface com.citrix.xenclient.db read" >> /etc/rpc-proxy.rules

echo "allow dom-uuid 00000000-0000-0000-0000-000000000003 \
destination com.citrix.xenclient.db \
interface com.citrix.xenclient.db read_binary" >> /etc/rpc-proxy.rules
</screen>
<para>To enable write access, replace <literal>read</literal> with <literal>write</literal> and <literal>read_binary</literal> with <literal>write_binary</literal> in the preceding example.</para>

</section>
<section><title>&PRODUCT_BRAND; Configuration Automation</title>

<procedure><title>To Create a Tap Device for Encrypted VHD</title>
<step><para>Create a key in a key store directory with the following name:</para>
<screen><replaceable>vhd_uuid</replaceable>,aes-xts-plain,256.key</screen>
<para>The <replaceable>vhd_uuid</replaceable> is the UUID of the VHD to be created, for example <literal>7313383c-98db-4770-9a50-64a38ba5ee96</literal>.</para></step>
<step><para>Run the following command to create the encrypted VHD:</para>
<screen>TAPDISK2_CRYPTO_KEYDIR=<replaceable>key_directory_location</replaceable> tap-ctl create \
 -a vhd:<replaceable>vhd location</replaceable></screen>
<para>Following on from the previous example, an example of this command would be:</para>
<screen>TAPDISK2_CRYPTO_KEYDIR=/config/sec/s-remoteuser-436...c453 \
tap-ctl create \
-a vhd:/storage/disks/7313383c-98db-4770-9a50-64a38ba5ee96.vhd</screen></step>
</procedure>
<note><para>The key directory name in the previous example has been shortened as indicated by the <literal>...</literal> ellipsis.</para></note>
</section>
-->

</chapter>

<!-- <xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="experimental_features" xmlns:xi="http://www.w3.org/2001/XInclude" />  -->

<chapter id="troubleshooting"><title>Troubleshooting</title>
<section><title>General Troubleshooting</title>
		<para><indexterm><primary>&PB;</primary><secondary>troubleshooting</secondary></indexterm><indexterm><primary>Troubleshooting</primary><secondary>general</secondary></indexterm>If you experience a technical issue with &PB;, please immediately generate a system status report to capture essential information from the system that will enable diagnosis. The status report can be supplied to a technical support representative. You may also want to visit the &PB; Forums <ulink url="http://forums.citrix.com/forum.jspa?forumID=1551">here</ulink><footnote><para>http://forums.citrix.com/forum.jspa?forumID=1551</para></footnote> for solutions.</para>
		
<procedure>
<title>
<indexterm><primary>Control domain</primary><secondary>opening a console</secondary></indexterm>
<indexterm><primary>Console, control domain</primary></indexterm>
To Open a Control Domain Console</title>
<step><para>&OPEN_CONSOLE; Alternately press <keycap>Ctrl + Shift + H</keycap> to open a larger control domain terminal window.</para>
<note><para>Use <keycap>Alt + Tab</keycap> to bring the console back into focus should it end up behind &BC;.</para></note></step>
</procedure>		
		
<procedure><title>To Generate a &PB; Status Report<indexterm><primary>Status report</primary>
<secondary>generating</secondary></indexterm></title>

<important><para>VMs must be running for the status report to be able to gather important VM-specific diagnostic information.</para></important>

<step><para>SELinux must be temporarily disabled in the control domain to generate a status report. To disable it:</para>
<substeps>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Enter the commands</para>
<screen>nr
setenforce 0</screen>
</step>
</substeps>
</step>

<step><para>In &BC;, click <guilabel>Info > Status Report</guilabel>, then click the <guilabel>Create Status Report</guilabel> button. Alternately, press <keycap>Ctrl + Alt + R</keycap>. The <guilabel>Create Status Report</guilabel> wizard is displayed.</para></step>

<step><para>Select what information you would like to include in the status report. Screenshots and diagnostic information about the VMs running on the &PB; device can be extremely helpful with the diagnosis of technical issues, but you may prefer not to divulge this information. If you do not want to include screenshots of VMs in the status report, uncheck the <guilabel>Include screenshots of the VMs in this report checkbox</guilabel>. If you do not want any other diagnostic information about your VMs to be included, uncheck the <guilabel>Include other diagnostic information from the VMs in this report</guilabel> checkbox.</para>
</step>
<step><para>Click the <guilabel>Next</guilabel> button.</para></step>

<step><para>Enter a short (8 words or less if possible) summary of the problem you have encountered in the <guilabel>Summary</guilabel> text box.</para></step>
<step><para>Enter a more detailed description of the problem in the <guilabel>Description</guilabel> text area.</para></step>

<step><para>Click the <guilabel>Next</guilabel> button.</para></step>

<step><para>Enter the steps that you think are required to reproduce the problem in the <guilabel>Steps to Reproduce</guilabel> text area.</para></step>
<step><para>If you have contacted &COMPANY_NAME_SHORT; with regard to this issue and have been given a technical support case number or a ticket number, enter the number you have been given in the <guilabel>Support Number</guilabel> text box.</para></step>


<step><para>Click the <guilabel>Next</guilabel> button.</para></step>

<step><para id="test_xinclude">Click the <guilabel>Next</guilabel> button again to start generating the report. The report is saved as a <literal>.tar.gz</literal> file on the control domain file system in the <filename>/storage/status-report</filename> directory. The file is named after the summary of the issue.</para>
<para>Because the status report might contain sensitive information, no direct download link is provided. It is instead required to log in to a control domain console as the <literal>root</literal> user in order to access the status report. Contact your system administrator if you do not access to the <literal>root</literal> user password to arrange for the status report to be retrieved. To retrieve the status report, either use <command>SCP</command>, <command>WinSCP</command>, or an equivalent tool.</para>
<!--
<para>Alternately, take the following steps:</para>
<substeps>
<step><para>Ensure that the device is connected to a network, either wired or wireless.</para>
</step>
<step><para>&OPEN_CONSOLE;</para></step>

<step><para>Run the <command>status-server</command> command:</para>
<screen>status-server</screen>
</step>
<step><para>Use a web browser on another device or in a VM to download the status report from the URL indicated by the <literal>status-server</literal> command.</para>
</step>
<step><para>Press <guilabel>Enter</guilabel> to shut down the status server.</para>
</step>

</substeps>
-->

</step>
<step><para>Re-enable SELinux as follows:</para>
<substeps>
<step><para>&OPEN_CONSOLE;</para></step>
<step><para>Enter the commands:</para>
<screen>nr
setenforce 1</screen>
</step>
</substeps>
</step>

</procedure>

<section id="recovering_from_full_disk">
	<title>Recovering From a Full Disk</title>
	<procedure>
		<step><para>Reboot the &PB; host.</para></step>
		<step><para>While the &PB; boot screen is displayed, press <keycap>Esc</keycap>.</para></step>
		<step><para>Select <guilabel>&PB; Technical Support option: console access</guilabel>.</para></step>
		<step><para>When a console is available, you will be prompted to enter the administrative password, which is the password you created when you installed &PB;.</para></step>
		<step><para>Delete the file <filename>/storage/xc-reserved</filename>:</para>
		<screen>rm /storage/xc-reserved</screen>
		<para>This will free up sufficient disk space to allow you to boot into &PB; and back up your VMs.</para></step>
	</procedure>	
</section>

<section id="moving_hard_disk_to_another_system">
	<title>Moving a Hard Disk from One &PB; System to Another</title>
	<para>When you move a hard disk from one &PB; system to another, you need to "bless" the disk. This is a security feature to keep the data secure in case of theft.</para>
	<procedure>
		<step><para>After putting the drive in the &PB; device, start it up.</para></step>
		<step><para>While the &PB; boot screen is displayed, press <keycap>Esc</keycap>.</para></step>
		<step><para>Select <guilabel>&PB; Technical Support option: console access</guilabel>.</para></step>
		<step><para>When a console is available, you will be prompted to enter the administrative password, which is the password you created when you installed &PB;.</para></step>
		<step><para>You will then be asked, "Would you like to reseal the device with the current configuration?" Answer yes, then you can reboot the device and use your VMs.</para></step>
	</procedure>	 
</section>


<section id="optical_drive_assignment">
	<title>Optical Drive Assignment When &BC; Is In Focus</title>
	<para>When &BC; is in focus, and a CD/DVD is inserted in the optical drive, it is assigned to the VM that gets focus first upon switching. The optical drive is then not available from other VMs unless you release it from the VM it was assigned to.</para>
</section>

<section id="turning_on_atapi_logging">
	<title>To Turn On ATAPI Logging to Debug CD/DVD Issues</title>
	<procedure>
		<step><para>Open a console from &BC;.</para></step>
		<step><para>Run the command:</para>
		<screen>touch /etc/debugcdrom</screen></step>
		<step><para>Logs will be written to <filename>/var/log/cdrom-<replaceable>VM_slot_number</replaceable>.log</filename> until the <filename>/etc/debugcdrom</filename> file is removed.</para></step>
	</procedure>
</section>

<section id="booting_into_control_domain_console">
<title>To Boot Into a Control Domain Console</title>
	<procedure>
		<step><para>Reboot the &PB; host.</para></step>
		<step><para>While the &PB; boot screen is displayed, press and hold <keycap>Shift</keycap>.</para></step>
		<step><para>Boot into the <guilabel>console access</guilabel> option.</para></step>
		<step><para>When a console is available, log in as <literal>root</literal>.</para></step>
	</procedure>
</section>

<section id="refreshing_ui">
	<title>To Refresh &BC;</title>
	<procedure>
		<step><para>In &BC;, press <keycap>Ctrl + Q</keycap>.</para></step>
	</procedure>
</section>

<section id="changing_control_domain_root_password">
	<title>To Change the Control Domain Root Password<indexterm><primary>Control domain</primary>
<secondary>changing root password</secondary></indexterm></title>
	<procedure>
		<step><para>&OPEN_CONSOLE;</para></step>
		<step><para>Create a text file containing your old password.</para></step>
		<step><para>Create a text file containing your new password.</para></step>
		<step><para>Run the following command:</para>
		<screen>sec-change-root-credentials <replaceable>new_password_file_path</replaceable> \
<replaceable>old_password_file_path</replaceable></screen>
		<para>Both files will be securely deleted when you run the <command>sec-change-root-credentials</command> command.</para></step>
	</procedure>
</section>

<section id="troubleshooting_ubuntu_drivers">
	<title>To Troubleshoot Ubuntu Driver Issues</title>
	<para>Ubuntu in &PB; &PRODUCT_VERSION; uses paravirtualized drivers to increase performance by eliminating CPU cycles previously used to emulate devices. Should you experience problems, you can try reverting to the emulated drivers using this procedure:</para>
	<procedure>
	<step><para>&OPEN_CONSOLE;</para></step>
	<step><para></para>Run the command:
		<screen>xec-vm -n <replaceable>vm_name</replaceable> set viridian true</screen>
	</step>
	<step><para>Reboot your Ubuntu VM.</para></step>
	</procedure>
</section>

<section id="ubuntu_vms_wifi_connections">
	<title>WiFi Connections and Ubuntu VMs</title>
	<para>In Ubuntu VMs, WiFi connections appear as wired connections. The connection shows a NAT'd IP address in the VM because host WiFi is always shared (that is, NAT'd), rather than bridged, due to the nature of WiFi networks.</para>
</section>

<section id="masking_sses_in_vm_cpuid">
	<title>Masking SSEs in the VM CPUID</title>
	<para>Some PXE servers require that some Streaming SIMD Extensions (SSEs) are masked in the CPUID of a VM. To do this:</para>
	<procedure>
		<step><para>&OPEN_CONSOLE;</para></step>
		<step><para>Run the following command to disable SSE, SSE 4.2, SSE 4.1, SSE 3 and SSE2:</para>
		<screen>xec-vm -n <replaceable>vm_name</replaceable> set cpuid \
1:ecx=xxxxxxxxxxx00xxxxxxxxx0xxxxxxxx0,edx=xxxxx00xxxxxxxxxxxxxxxxxxxxxxxxx</screen>
		<para>In this command, <literal>0</literal> causes the corresponding bit to be unset and <literal>x</literal> sets the corresponding bit to a safe default.</para>
		<para>To reset the CPUID back to default at a later stage, run the command:</para>
		<screen>xec-vm -n <replaceable>vm_name</replaceable> set cpuid ""</screen></step>
	</procedure>
</section>

<section id="reurning_to_ui_from_unresponsive_vm">
	<title>To Return to &BC; from an Unresponsive VM (Force Switching)</title>
	<para>Use this procedure to return to &BC; if a VM with &HDX; enabled becomes unresponsive to attempts to switch away from it.</para>
	<warning><para>Forcing a switch should only be attempted as a last resort. Particularly, forcing a switch while a &HDX; VM is booting or shutting down can lead to the VM graphics becoming corrupt. &COMPANY_NAME_SHORT; highly recommends immediately shutting down any VM you have force switched away from and restarting it.</para></warning>
	<procedure>
		<step><para>Press and hold <keycap>Ctrl + 0</keycap> for 15 seconds.</para></step>
		<step><para>If &BC; is still not displayed, press <keycap>Ctrl + 0</keycap> once again to switch to &BC;.</para></step>
	</procedure>
</section>

<section id="determining_device_ip">
	<title>To Determine the IP Address of a &PB; Device</title>
	<procedure>
		<step><para>In &BC; click on the Network Manager icon at the top-right of the screen, and select <guilabel>Connection Information</guilabel> from the popup menu.</para></step>
		<step><para>The details of all active network connections are displayed, including the IP address.</para>
		<!-- The following note only applies to XT, so make sure to refactor this so it doesn't appear in the Express docs -->
		<note><para>The IP address of the wired connection as displayed in the <guilabel>Connection Information</guilabel> box in &RECEIVER; is not the IP address of the hypervisor control domain. Instead, it displays the IP address of the Network Driver Domain service VM (NDVM). If you have enabled ssh, open a terminal from the &RECEIVER;, log in, and run the command <command>ifconfig</command> to obtain the IP address of <literal>eth0</literal>. Use this IP address to ssh to the control domain.</para></note>
		</step>
	</procedure>
</section>
<section id="clearing_tpm_firmware">		
	<title>To Clear the Trusted Platform Module (TPM) firmware</title>	
	<para><indexterm><primary>Trusted Platform Module (TPM)</primary></indexterm>Refer to the BIOS section of your PC manual for instructions on clearing the TPM.</para>
</section>		

</section>

<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="installation_troubleshooting" xmlns:xi="http://www.w3.org/2001/XInclude" />

</chapter>

<appendix id="resource_allocation"><title>How &PB; Allocates Resources to VMs</title>

<para>Given that multiple VMs are using the same hardware, &PB; must manage this interaction. This appendix describes how &PB; handles shared hardware resources.</para>

<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="allocating_resources-vcpus" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="allocating_resources-memory" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="allocating_resources-gpu" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="allocating_resources-network_and_internet_connections" xmlns:xi="http://www.w3.org/2001/XInclude" />

<section id="usb_devices"><title>USB Devices<indexterm><primary>&PB; device sharing</primary>
<secondary>USB devices</secondary></indexterm></title>
<para><indexterm><primary>&PB;</primary><secondary>USB device handling</secondary></indexterm>USB devices are handled differently according to their type. Human Interface Devices (HID) (for example, the mouse and keyboard) are directly connected to the &PB; platform and exposed in a secure manner to the VM that is currently in active use. Other USB devices, for example external disk drives and CD drives, would potentially suffer from contention issues if more than one VM attempts to write to them simultaneously. Because of this, &PB; attaches such devices to the VM that is being used when they are plugged in to the computer. You can also use &BC; to assign a plugged-in USB device to a different VM.</para>
<important>
<itemizedlist>
<listitem><para>&COMPANY_NAME_SHORT; recommends that you take care to eject USB devices as the operating system expects before assigning them to another VM. Not doing this causes &PB; to force-eject the USB device, which can lead to loss of data.</para></listitem>
<listitem><para>&COMPANY_NAME_SHORT; highly recommends not updating the firmware or software of any device attached to a &PB; device over USB. Such updates have been known to fail and may render the device unusable.</para></listitem>
</itemizedlist>
</important>

<!--
<para>&PB; supports the following types of USB devices:</para>

<itemizedlist>
<listitem><para>USB optical media device</para></listitem>
<listitem><para>USB storage: hard drive, USB key</para></listitem>
<listitem><para>USB printers</para></listitem>
<listitem><para>USB keyboard</para></listitem>
<listitem><para>USB mouse</para></listitem>
</itemizedlist>
-->
<note><itemizedlist>
<listitem><para>Plugging a non-HID USB device into your &PB; computer while switched to &BC; causes the USB device to be mounted in the hypervisor control domain by default. You can then assign the device to a VM using &BC;.</para></listitem>
<!--
<listitem><para>When using a non-HID USB device with a &PORTICA; application, the device must be plugged in when the VM that the application is running from is active and in focus. See <olink targetdoc="XenClientSetupAndUsageGuide" targetptr="portica" /> for information about &PORTICA;.</para></listitem>
-->
</itemizedlist>
</note>

<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="usb_devices-external_optical_drives" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="usb_devices-keyboards_pointing_devices" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="usb_devices-other_devices" xmlns:xi="http://www.w3.org/2001/XInclude" />

<section id="usb_devices-composite"><title>Composite USB Devices<indexterm><primary>USB devices</primary>
<secondary>composite</secondary></indexterm></title>
<para>Composite USB devices expose interfaces to more than one USB device function. An example of this sort of composite device is a USB webcam with an integrated microphone.</para>
</section>

<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="usb_devices-internal" xmlns:xi="http://www.w3.org/2001/XInclude" />

</section>

<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="allocating_resources-optical_media_sharing" xmlns:xi="http://www.w3.org/2001/XInclude" />

<section id="allocating_resources-vhd_sparse"><title>Hard Drive Disk Sharing<indexterm><primary>&PB; device sharing</primary>
<secondary>hard drive</secondary></indexterm></title>
<para>&PB; uses a thin-provisioning strategy for VM virtual disks. This means that disk space is only taken up when the virtual disk is written to. It is therefore possible to assign more virtual disk space to VMs than is physically available, and equally possible to fill the entire hard drive should you take this approach. Please exercise caution not to end up in a position where a VM attempts to write to a full disk, as this can cause catastrophic &PB; failure.</para>

<para>To recover from the situation where you have filled the &PB; disk, follow <olink targetdoc="XTEngineAdministratorGuide" targetptr="recovering_from_full_disk" />.</para>

</section>

<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="allocating_resources-manufacturer_specific_features" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="allocating_resources-external_monitors_docking_stations" xmlns:xi="http://www.w3.org/2001/XInclude" />

</appendix>

<!--
Moved to new doc, XTSecurityArchitectureGuide

<appendix><title>Implementation Notes</title>
<section id="txt_trusted_boot"><title>TXT Trusted Boot Process</title>
<para><indexterm><primary>Trusted Execution Technology (TXT)</primary></indexterm><indexterm><primary>Trusted Platform Module (TPM)</primary></indexterm>&PB; uses Intel TXT for hardware-based, dynamic root of trust (DRTM) measurement and verification of the &PB; launch environment. TXT is invoked prior to &PB; boot, suspend, restart and shutdown. TXT uses open-source (tboot) and closed-source (SINIT) chipset-specific software that is developed and maintained by Intel. Successful functioning of TXT also depends on processor support, the quality of an OEM's BIOS implementation and Trusted Platform Module (TPM) firmware.</para>  
<section><title>TXT Initial Setup Process</title>
<para>The following diagram shows the initial TXT  setup process.</para>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata align="center" fileref="images/trusted_boot_process_setup.png" width="75%" />
</imageobject>
</mediaobject>
</informalfigure>	
-->

<!--
<screen>administrator executes /usr/bin/tpm-setup
if BIOS version is earlier than minimum version requirement
    prompt user to update BIOS
    exit tpm-setup script
if TPM is not already owned with well known SRK password
    if error is "Authentication failed", set well known password
    if error is "No SRK", take ownership of TPM
        if error message is "No EK"
            create TPM EK
            prompt user to restart script
            exit tpm-setup script
    repeat test to confirm that TPM is owned with well known SRK password 
    store list of PCRs to be sealed in /config/config.pcrs if 
    /config/config.key does not exist
create key by getting 32 bytes from /dev/random
set LUKs slot 1 of the config value to use this key</screen>
-->

<!--
</section>
<section><title>Trusted Boot Process: Verification on Boot</title>
<para>The following diagram shows the verification process that occurs at device boot time.</para>
<informalfigure>
<mediaobject>
<imageobject>

<imagedata align="center" fileref="images/trusted_boot_process_verify_on_boot.png" width="75%" />
</imageobject>
</mediaobject>
</informalfigure>	
-->

<!--
<screen>if tpm is enabled (admin previously executed the tpm-setup process)
    if txt-stat | grep 'TXT measured launch' | awk '{print $4}' == TRUE
    the system was booted securely
        is it the first boot after tpm-setup?
            use the old device key to unseal the /config partition
            reseal the /config partition
        else if  (cannot mount /config, i.e. config changed and this is not 
        first boot after tpm-setup)
			Print "Unauthorized system modification detected"
            prompt user for the recovery password
            offer the option of resealing the system
            reseal if requested by admin
        else
            the system was not booted securely, TXT measured launch failed
            warn admin that BIOS could be incompatible
            ask admin to create a status report
            prompt admin for password to mount /config partition
            do not offer to reseal the /config partition</screen>
			
-->

<!--
</section>  
<section><title>Implementation Notes</title>      
<para>The following TXT components are measured and verified on boot:</para>
<itemizedlist>
<listitem><para>Control Domain (dom0) - sha1sum of root file system</para></listitem>
<listitem><para>User Interface Service VM - sha1sum of root file system</para></listitem>
<listitem><para>Network Driver Service VM - sha1sum of root file system</para></listitem>
<listitem><para>Command line of the grub2 bootloader</para></listitem>
</itemizedlist>
<section><title>Measurements from tboot</title>
<variablelist>
<varlistentry><term>PCR 15</term><listitem><para role="die">Used to store dom0 filesystem hash (done in initramfs)</para></listitem></varlistentry>

<varlistentry><term>PCR 17</term><listitem><para role="die">Used by TBOOT (documentation from <filename>TXT_Architecture_31516804_2008.pdf</filename>, section 1.9.1)</para>
<itemizedlist>
<listitem><para role="die">SHA-1 hash of BIOS ACM: SinitMleData.BiosAcmID (20 bytes)</para></listitem>
<listitem><para role="die">STM opt-in indicator: SinitMleData.MsegValid (8 bytes)</para></listitem>
<listitem><para role="die">SHA-1 hash of the STM (or all 0s if opt-out): SinitMleData.StmHash (20 bytes)</para></listitem>
<listitem><para role="die">LCP Control Field of used policy (PD or PO): SinitMleData.PolicyControl (4 bytes)</para></listitem>
<listitem><para role="die">SHA-1 hash of used policy (or all 0s if chosen not to be extended): SinitMleData.LcpPolicyHash (20 bytes)</para></listitem>
<listitem><para role="die">MLE-chosen Capabilities (or all 0s if chosen not to be extended): OsSinitData.Capabilities (4 bytes)</para></listitem>
</itemizedlist>
</listitem></varlistentry>



<varlistentry><term>PCR 18</term><listitem><para>Used by TBOOT, signature of tboot.gz (documentation from <filename role="die">TXT_Architecture_31516804_2008.pdf</filename>, section 1.9.2)</para></listitem></varlistentry>

<varlistentry><term>PCR 19</term><listitem><para>Used by TBOOT, signature of the other multiboot modules and boot command line option (xen, dom0 kernel, initramfs, SELinux policy).</para></listitem></varlistentry>

</variablelist>
</section>
<section><title>Measurement from initramfs</title>
<itemizedlist>
<listitem><para>Compute sha1sum of root partition.</para></listitem>
<listitem><para role="die">Extend PCR 15 using the computed sha1sum: echo $s | tpm_extendpcr_sa -p 15</para></listitem>
</itemizedlist>
</section>
<section><title>Quote</title>
<itemizedlist>
<listitem><para>Use <command>TPM_Quote2</command> to get a TPM quote on the requested PCRs and with the supplied nonce.</para></listitem>
<listitem><para>Output is a signature and the data block that has been signed.</para></listitem>
<listitem><para>Data block contains the list of PCRs, the locality and a digest of the PCR values.</para></listitem>
<listitem><para>Quote file also includes PCR values but those are not signed and cannot be verified other than by computing the digest.</para></listitem>
</itemizedlist>
</section>
<section><title>Verify</title>
<itemizedlist>
<listitem><para>Use openssl <command>rsa_verify</command> to check the signature of the data block.</para></listitem>
<listitem><para>Compare nonce if supplied.</para></listitem>
<listitem><para>Output list of PCRs and locality.</para></listitem>
<listitem><para>Also output nonce, if not supplied.</para></listitem>
<listitem><para>Output digest of the PCR values.</para></listitem>
</itemizedlist> 
</section>
</section>
<section><title>Password Handling</title>
<para>Changes made to the configuration partition cause the system to prompt for the passphrase set in the TPM setup process. Run the following command to change this passphrase if required:</para>
<screen>openssl rsa -des3 -in /boot/system/install/data/recovery-private-key.conf \
-passin stdin -out /boot/system/install/data/recovery-private-key.conf \
-passout stdin</screen>
<para>Enter the old passphrase and press <keycap>Enter</keycap>. Then enter the new passphrase and press <keycap>Enter</keycap>. The following output is written to the console:</para> 
<screen>writing RSA key</screen>
</section> 

</section>

</appendix>
-->

 <appendix id="pxe_install"><title>Installing &PB; Over a Network Using PXE</title>
<para>This appendix describes how to set up PXE boot and enable the installation of &PB; over a network.
<indexterm><primary>&PB;</primary><secondary>installing using PXE</secondary></indexterm>
<indexterm><primary>Installing &PB; using PXE</primary></indexterm>
<indexterm><primary>PXE, installing &PB; via </primary></indexterm>
</para>
<para>&PB; &PRODUCT_VERSION; uses a customized <filename>pxelinux.0</filename> file, which can be found on the installer CD at <filename>/isolinux/pxelinux.0</filename>. This file must be copied to your PXE server.</para>
<para>The first step is to copy the <filename>packages.main</filename> directory from the &PB; installer CD to a location on an FTP or HTTP server. The location URL of the parent directory of the <filename>packages.main</filename> directory is specified in the answerfile created in the next step.</para>
<para>The second step is to create an answerfile and put it in the same directory as the <filename>packages.main</filename> folder. The answerfile specifies the answers to questions asked by the &BC; installer, and the location of the required packages.</para>
<note><para>Please ensure that your networking configuration is set up to enable PXE boot. For example, if you are using DHCP please ensure that your DHCP server is configured to provide the route to your TFTP server.</para></note>
<para>The following is an example answerfile:</para>
<screen><![CDATA[<interactive>false</interactive>
<mode>fresh</mode>
<source type="url">http://192.168.1.1/xenclient_packages_dir</source>
<primary-disk>sda</primary-disk>
<network-interface mode="dhcp"></network-interface>
<password>3oUQYK4w4dCB.</password>
<enable-ssh>true</enable-ssh>
<license-key></license-key> ]]>
</screen>
<para>Next, copy the contents of the <filename>isolinux</filename> directory into the PXE directory on your TFTP server, for example, <filename>/tftpboot/pxe</filename>. Then edit the file <filename>isolinux.cfg</filename>, which is an example config file used by the PXELINUX program (<ulink url="http://www.syslinux.org/wiki/index.php/PXELINUX">http://www.syslinux.org/wiki/index.php/PXELINUX</ulink>). You can use this as a working example to build a config appropriate for your network. For simple configurations you should only need to edit the file to specify the location of your answerfile. For example, if you placed your answerfile on a web server, you could provide the HTTP URL as follows:</para>
<screen>answerfile=http://mywebserver.com/answers.ans</screen>
<para>Save the edited the <filename>isolinux.cfg</filename> file to the default config location for PXELINUX, which is <filename>pxelinux.cfg/default</filename> relative to the root of the PXE directory on your TFTP server, for example, <filename>/tftpboot/pxe/pxelinux.cfg/default</filename>.</para>

<note>
<para>The manner in which <literal>PXELINUX</literal> selects which <filename>pxelinux.cfg</filename> to use when a machine boots on the network is determined by a number of factors. The provided file simply places the configuration in the default location where it will be used by all machines served by DHCP on the network when they network boot.</para>
</note>

<!-- There was an example file here wrapped in a CDATA tag that did not take kindly to being commented out. I put the text in the file named removed example pxelinux config file.txt in case it needs to be returned. -->

<para>The following table describes the allowable syntax of a &PB; answerfile.<indexterm><primary>Answerfile, PXE installations</primary></indexterm></para>
<warning><para>The answerfile uses a pseudo-XML syntax and is not parsed by an XML parser. With the exceptions of the <literal>preinstall</literal>, <phrase role="die"><literal>postinstall</literal></phrase> and <literal>quick-option</literal> tags which may span multiple lines, all tags should be on one line only with no extraneous whitespace.</para>
<para>The backslash (<literal>\</literal>) characters used in examples to indicate the continuation of a line must be removed in the actual configuration file.</para>
</warning>

   <informaltable frame="none" width="6.5in">
<!--   <?dbfo keep-together="auto" ?> -->
    <tgroup cols="3">
     <colspec colwidth="1.00in"/>
     <colspec colwidth="4.5in"/>
	 <colspec colwidth="1.00in"/>
     <thead>
      <row>
       <entry>
        <para>Tag name</para>
       </entry>
       <entry>
        <para>Description</para>
       </entry>

      	 <entry><para>Required?</para></entry>

      </row>
     </thead>
     <tbody>
	 <row>
	 <entry><para>interactive</para></entry>
	 <entry><para>Determines whether the installer will interact with the user or not. If <literal>false</literal> the answerfile must contain all mandatory tags or the installation will fail. If <literal>true</literal> the user will be prompted to provide information where answerfile entries do not exist.</para>
<screen><![CDATA[<interactive>true</interactive>
	 
<interactive>false</interactive>]]></screen></entry>

	 <entry><para>no</para></entry>

	 </row>
		 <row>
	 <entry><para>quick-option
</para></entry>
	 <entry><para>Used as a parent for other answerfile tags. If this tag is in the answerfile, the user will be prompted to choose whether they want to perform a quick install or an advanced install. If the user selects to do a quick install, the answerfile tags that are children of this tag, that is, between <literal>&lt;quick-option&gt;</literal> and <literal>&lt;/quick-option&gt;</literal>, are used, as well as all the other tags in the answerfile. If the user chooses the advanced install, this tag is ignored and the options specified elsewhere in the answerfile are used.</para>
<screen><![CDATA[<quick-option>
# other answerfile tags go here 
# for quick install
</quick-option>]]></screen></entry>

	 <entry><para>no</para></entry>

	 </row> 
	 
	 	 <row>
	 <entry><para role="die">eula</para></entry>
	 <entry><para>Set the <literal>accept</literal> parameter of the <literal>eula</literal> element to <literal>yes</literal> to automatically accept the &PB; end-user license agreement (EULA). Set the parameter to <literal>defer</literal> to cause the user to be prompted to accept the EULA when first booting the &PB; device.</para>
<screen><![CDATA[<eula accept="defer">]]></screen></entry>

	 <entry><para>no</para></entry>
	 </row>  

	 
	 <row>
	 <entry><para>source</para></entry>
	 <entry><para>The installation package source. The URL option can specify either <literal>http</literal> or <literal>ftp</literal>. The <literal>local</literal> option is for optical media installs. The <literal>verify="true"</literal> attribute determines whether or not the media should be verified before performing the installation.</para> 
	 <para>If you specify the <literal>type="harddisk"</literal> attribute, the installer <literal>initrd</literal> must be repacked to include a copy of the <filename>packages.main</filename> repository at the root of the
filesystem. A copy of this repository can be found on the installation ISO. This option enables PXE-only network installation in situations where network installation using the other options is not feasible.</para> 
<para>If you specify the <literal>type="bootmedia"</literal> attribute, the installer will attempt to install from a bootable partition. To prepare a bootable partition, boot from the &PB; installation media, then press <keycap>Alt + F3</keycap> to open a console window. In the console, log in as <literal>root</literal> and run the <filename>prepare-hd-install</filename> script to copy the installer and the repository from the CD-ROM to the partition.</para>
<para>Specify the <literal>oem="true"</literal> attribute if you want the installer to treat the prepared partition as an OEM partition when partitioning the disk.</para>
<screen><![CDATA[<source type="url"> \
http://127.0.0.1/foo/bar</source>

<source type="bootmedia"></source>

<source type="local" verify="true"> \
</source>
<source type="harddisk" oem="true"> \
</source>]]></screen></entry>

	 <entry><para>no</para></entry>

	 </row>  
	  <row>
	 <entry><para>mode
</para></entry>
	 <entry><para>Required for automated installation.
Indicates whether to perform a destructive <literal>fresh</literal> installation in which all data on the primary drive will be destroyed, or to <literal>upgrade</literal> an existing installation.</para>
<screen><![CDATA[<mode>fresh</mode>
	 
<mode>upgrade</mode>]]></screen></entry>

	 <entry><para>yes</para></entry>
	 </row>  

	 <row>
	 <entry><para>primary-disk
</para></entry>
	 <entry><para>Required for automated installation if more than one disk is detected on the machine. Specify the UNIX disk name.</para>
<screen><![CDATA[<primary-disk>sda</primary-disk>]]></screen></entry>

	 <entry><para>sometimes</para></entry>
	 </row>
	 
	 <row>
	 <entry><para>partition-mode
</para></entry>
	 <entry><para>Determines what changes are made to the partition layout of the
primary disk when performing a fresh installation.</para>
<para>The <literal>overwrite</literal> option will overwrite an existing installation. All
other partitions on the disk will be preserved. This option is only
available if there is an existing installation on the disk.</para>
<para>The <literal>use-free-space</literal> option will install into the available free space
on the disk. All existing partitions on the disk will be preserved.
This option is only available if free space exists on the disk, a new
primary partition can be created and there is no existing installation
on the disk.</para>
<para>The <literal>erase-non-oem</literal> option will preserve any OEM partitions, erasing
all other partitions on the disk and installing into the available
space. (At present only Dell Utility Partitions are detected as OEM
partitions.)</para>
<para>The <literal>erase-entire-disk</literal> option will erase all partitions on the disk
and install into the free space. All existing partitions will be
erased.</para>
<para>If no option is specified for an automated installation, the installer
will attempt to use the following options in order:</para>
<orderedlist>
 <listitem><para>overwrite</para></listitem>
<listitem><para>use-free-space</para></listitem>
 <listitem><para>erase-non-oem</para></listitem>
 <listitem><para>erase-entire-disk</para></listitem>
</orderedlist>
<screen><![CDATA[<partition-mode>overwrite \
</partition-mode>
<partition-mode>use-free-space \
</partition-mode>
<partition-mode>erase-non-oem \
</partition-mode>
<partition-mode>erase-entire-disk \
</partition-mode>
<partition-mode></partition-mode>
]]></screen></entry>

	 <entry><para>yes</para></entry>
	 </row>
	 
		 <row>
	 <entry><para role="die">install-mbr
</para></entry>
	 <entry><para>Determines whether a new master boot record is installed on the target
disk. The <literal>auto</literal> option will install a new master boot record unless an OEM
master boot record is found on the target disk. Only Dell
master boot records are detected. Defaults to <literal>auto</literal> if no option is specified.</para>
<screen><![CDATA[<install-mbr>true</install-mbr>
<install-mbr>false</install-mbr>
<install-mbr>auto</install-mbr>
<install-mbr><install-mbr>
]]></screen></entry>

	 <entry><para>no</para></entry>
	 </row>  
	 
	 
	<row>
	 <entry><para>network-interface
</para></entry>
	 <entry><para>Specifies the network device for use by the installer. Required for automated installs performed over the network.</para>
<screen><![CDATA[<network-interface mode="dhcp"> \
</network-interface>

<network-interface mode="static" \
address="10.0.0.1" \
netmask="255.255.255.0" \
gateway="10.0.0.2" dns="10.0.0.3"> \
</network-interface>]]></screen></entry>

	 <entry><para>sometimes</para></entry>
	 </row> 
	 
	<row>
	 <entry><para>language</para></entry>
	 <entry><para>Used to set the user interface language. The following languages are supported:</para>
	<itemizedlist>
		<listitem><para>en-us (English)</para></listitem>
		<listitem><para>fr-fr (French)</para></listitem>
		<listitem><para>de-de (German)</para></listitem>
		<listitem><para>ja-jp (Japanese)</para></listitem>
		<listitem><para>zh-cn (Simplified Chinese)</para></listitem>
		<listitem><para>es-es (Spanish)</para></listitem>
	</itemizedlist>
	<para><emphasis role="italic">Example:</emphasis></para>
	<screen><![CDATA[<language>fr-fr</language>]]></screen>
	<para>Specify the <literal>defer</literal> option to cause the user to be prompted to set
the language on first boot.</para>
<screen><![CDATA[<language defer="true"></language>]]></screen>
 <para>If the language element is not included in the answer file, the language defaults to en-us (US English).</para></entry>
	 <entry><para>no</para></entry>
	 </row> 

	<row>
	 <entry><para>keyboard
</para></entry>
	 <entry><para>Used to set the keyboard layout. The following keyboard layouts are supported:</para>
<itemizedlist>
	<listitem><para>cn (China)</para></listitem>
    <listitem><para>fr (France)</para></listitem>
    <listitem><para>de (Germany)</para></listitem>
	<listitem><para>it (Italy)</para></listitem>
    <listitem><para>jp (Japan)</para></listitem>
    <listitem><para>es (Spain)</para></listitem>
	<listitem><para>ch (Switzerland)</para></listitem>
    <listitem><para>gb (United Kingdom)</para></listitem>
    <listitem><para>us (United States)</para></listitem>
	</itemizedlist>
	<para><emphasis role="italic">Example:</emphasis></para>
	<screen><![CDATA[<keyboard>us</keyboard>]]></screen>
<para>Specify the <literal>defer</literal> option to cause the user to be prompted to set
the keyboard layout on first boot.</para>
<screen><![CDATA[<keyboard defer="true"></keyboard>]]></screen>
<para>If the keyboard element is not included in the answer file, the keyboard layout defaults to us (United States).</para></entry>
	 <entry><para>no</para></entry>
	 </row> 
	 
	<row>
	 <entry><para>password
</para></entry>
	 <entry><para>Used to set the system password. The value is assumed to be an
encrypted password.</para>
<para>The following command can be used to generate an encrypted password:</para>
<screen>$ openssl passwd -1</screen>
<para>Setting an empty password permits access without entering a password.</para>
<para>Specify the <literal>defer</literal> option to cause the user to be prompted to set the password on first boot.</para>
<screen><![CDATA[<password></password>
<password>3oUQYK4w4dCB.</password>
<password defer="true"></password>]]></screen></entry>
	 <entry><para>no</para></entry>
	 </row> 
	 
	<row>
	 <entry><para>recovery-public-key
</para></entry>
	 <entry><para>Specifies a public/private key pair that enables the user to recover a forgotten password for an encrypted virtual disk.  </para>
<screen><![CDATA[<recovery-public-key> \
-----BEGIN PUBLIC KEY-----
.
.
-----END PUBLIC KEY----- \
</recovery-public-key>

<recovery-private-key> \
-----BEGIN RSA PRIVATE KEY-----
.
.
-----END RSA PRIVATE KEY----- \
</recovery-private-key>]]></screen>

<para>The following commands can be used to generate a public/private key pair with a passphrase:</para>
<screen>$ openssl genrsa -des3 -out private_key 2048
$ openssl rsa -pubout -in private_key -out public_key</screen>
</entry>

	 <entry><para>no</para></entry>
	 </row> 
	 	<row>
	 <entry><para>enable-ssh
</para></entry>
	 <entry><para>Used to enable or disable the control domain <command>ssh</command> server, which allows external ssh access for diagnostic purposes.</para>
<screen><![CDATA[<enable-ssh>true</enable-ssh>
	 
<enable-ssh>false</enable-ssh>]]></screen>
</entry>

	 <entry><para>no</para></entry>
	 </row>
<!-- <row>
	 <entry><para>license-key
</para></entry>
	 <entry><para>Used to supply the system license key.
Not currently functional.</para>
</entry>
	 <entry>
	 <screen><![CDATA[<license-key></license-key>]]></screen></entry>
	 <entry><para>no</para></entry>
	 </row>  -->
	
<!-- Remove mention of Synchronizer for XT Drop 5
	<row>
	 <entry><para>backend</para></entry>
	 <entry><para>Used to supply the host name or IP address of the &BACKEND; server. Not applicable for XenClient XT.</para>
<screen><![CDATA[<backend>my.backend.host.name</backend>]]></screen>	</entry>
	
	 <entry><para>no</para></entry>
	 </row> 
	 
	<row>
	 <entry><para>backend-pin</para></entry>
	 <entry><para>Used to supply a registration PIN for the &BACKEND; server. Not applicable for XenClient XT.</para>
<screen><![CDATA[<backend-pin>1234567</backend-pin>]]></screen>	</entry>
	
	 <entry><para>no</para></entry>
	 </row> 	
-->	 
	 
	 <!-- VHDs -->
	<row>
	 <entry><para role="die">vhds</para></entry>
	 <entry><para>Installs a precreated virtual hard disk on to the system.</para>

<para>Each <literal>vhd</literal> block specifies a virtual hard disk to be installed. (At
present only one virtual hard disk can be specified.) A new UUID
(universally unique identifier) will be assigned to the virtual hard
disk on installation.</para>

<para>The <literal>label</literal> option specifies a unique label for the virtual hard disk
which can be referenced in the <literal>vms</literal> element. This label is
only used during the installation process.</para>

<para>The <literal>vhd-source</literal> tag specifies the source of the virtual hard disk
image. Valid prefixes include:</para>
<itemizedlist>
 <listitem><para><literal>http://</literal></para></listitem>
 <listitem><para><literal>ftp://</literal></para></listitem>
 <listitem><para><literal>file://</literal></para></listitem>
 <listitem><para><literal>dev://</literal></para></listitem>

</itemizedlist>

<para>Note that the image will be retrieved after partitioning the
target disk, so if the <literal>dev://</literal> prefix is used, it must not refer to a
partition which is erased during the installation process.</para>

<para>If the <literal>vhd-source</literal> tag is specified multiple times, it is assumed
that the image has been split into fragments (for example, to work around a
file size limit on the source filesystem) which must be concatenated
to recover the original image.</para>

<para>The <literal>compress</literal> option indicates that the image has been compressed. Valid values are <literal>gzip</literal> and <literal>bzip2</literal>. If the image has also been split, it is assumed that the image was split after compression.</para>
<screen><![CDATA[<vhds>
  <vhd label="vhd1" compress="gzip">
    <vhd-sources>
      <vhd-source> \
	  dev://sda1/my.vhd.part1 \
	  </vhd-source>
      <vhd-source> \
	  dev://sda1/my.vhd.part2 \
	  </vhd-source>
    </vhd-sources>
  </vhd>
</vhds>]]></screen>	</entry>

	 <entry><para>no</para></entry>
	 </row> 

	 <!-- VMs -->
	<row>
	 <entry><para>vms
</para></entry>
	 <entry><para>Installs a precreated virtual machine on to the system.</para>

<para>Each <literal>vm</literal> element specifies a virtual machine to be installed. (At
present only one virtual machine can be specified.) A new UUID is 
assigned to the virtual machine on installation.</para>
<para>The <literal>vm-source</literal> tag specifies the source of the configuration file
for the virtual machine. Valid prefixes include:</para>
<itemizedlist>
 <listitem><para><literal>http://</literal></para></listitem>
 <listitem><para><literal>ftp://</literal></para></listitem>
 <listitem><para><literal>file://</literal></para></listitem>
 <listitem><para><literal>dev://</literal></para></listitem>

</itemizedlist>
 <warning><para>The file is retrieved after partitioning the target disk, so if the <literal>dev://</literal> prefix is used, it
must not refer to a partition which is erased during the installation process.</para></warning>
<para>The configuration file will automatically be updated to reflect the
virtual machine's new UUID.</para>
<para>The optional <literal>vm-vhds</literal> block allows the configuration file to be
updated to reflect the new UUIDs of any virtual hard disks used by the
virtual machine. Each <literal>vm-vhd</literal> tag specifies the index of the disk as
listed within the configuration file and the label of the disk as
specified in the <literal>vhd</literal> block.</para>
<screen><![CDATA[<vms>
  <vm>
    <vm-source>http://my.url/my-vm.db \
	</vm-source>
    <vm-vhds>
      <vm-vhd index="0" label="vhd1"> \
      </vm-vhd>
    <vm-vhds>
  </vm>
</vms>]]></screen>	</entry>

	 <entry><para>no</para></entry>
	 </row> 
	 
	 
	 <row>
	 <entry><para><phrase role="die">skipready</phrase>
</para></entry>
	 <entry><para>If this tag is present, the <guilabel>Are you ready to install?</guilabel> screen is not displayed.</para>
<screen><![CDATA[<skipready></skipready>]]></screen>	</entry>

	 <entry><para>no</para></entry>
	 </row> 
	 
	  <row>
	 <entry><para><phrase role="die">preinstall</phrase>
</para></entry>
	 <entry><para>Used to supply a script to be executed prior to installation.</para>
	 <warning><para>Including answerfile tags in the pre-install script can cause the answerfile parser to produce unpredictable results.</para></warning>
<screen><![CDATA[<preinstall>#!/bin/bash
touch /tmp/i.was.here
</preinstall>]]></screen>	</entry>

	 <entry><para>no</para></entry>
	 </row> 

	 <row>
	 <entry><para><phrase role="die">postinstall</phrase>
</para></entry>
<entry><para>A post install script, executed at the end of a successful installation.</para>
<screen><![CDATA[<postinstall>#!/bin/ash -e
mkdir -p /mnt/storage
mount /dev/xenclient/storage /mnt/storage
mkdir -p /mnt/storage/hello-from-postinstall
cd /mnt/storage/hello-from-postinstall
ls -l .. >postinstall-sample
cd /
umount /mnt/storage
</postinstall>]]></screen>	</entry>
	 
	 <entry><para>no</para></entry>
	 </row> 
    <row>
    <entry><para><phrase role="die">measure-launch</phrase></para></entry>
    <entry><para>Configure &PB; Measured Launch. The default is to not configure Measured Launch during anything other than an advanced interactive install. Providing the value <literal>true</literal> in this tag will cause installer to configure Measured Launch by default. If this value is set to <literal>false</literal> during an interactive install the user will not be given the option to configure Measured Launch.</para></entry>
    <entry><para>no</para></entry>
    </row>
	 </tbody>
	</tgroup>
</informaltable>	
</appendix>				
	<!--
	<appendix><title>&PB; Administration Tasks</title>
	<section><title>Controlling Which Applications Can Be Shared</title>
<para>The application spidering process is controlled by a configuration file which can be found in the following locations on the &PORTICA_SHARE; VMs:</para>
<variablelist>
<varlistentry><term>Windows 7</term>
<listitem><para><filename>C:\ProgramData\Citrix\Xci\Applications\XciDiscoveryConfig.xml</filename></para></listitem></varlistentry>

<varlistentry><term>Windows Vista</term>
<listitem><para>
<filename>C:\ProgramData\Citrix\Xci\Applications\XciDiscoveryConfig.xml</filename></para></listitem></varlistentry>

<varlistentry><term>Windows XP</term>
<listitem><para><filename>C:\Documents and Settings\All Users\Application Data\Citrix\Xci\Applications\XciDiscoveryConfig.xml</filename></para></listitem></varlistentry>
</variablelist>
<para>The following is an example of this configuration file:</para>
<screen><![CDATA[<?xml version="1.0" encoding="utf-8"?>
<XciDiscoveryConfig 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <DiscoveryPaths>
    <DiscoveryPath Enabled="true" 
      Recurse="true"
      Wildcard="*.lnk">
        C:\Users\username\AppData\Roaming\Microsoft\Windows\Start Menu
    </DiscoveryPath>
    <DiscoveryPath Enabled="true" Recurse="true" Wildcard="*.lnk">
      C:\ProgramData\Microsoft\Windows\Start Menu
    </DiscoveryPath>
  </DiscoveryPaths>
  <Whitelists>
    <Whitelist IgnoreCase="true">
      ^.:\\windows\\explorer.exe
    </Whitelist>
  </Whitelists>
  <Blacklists>
    <Blacklist IgnoreCase="true">
      ^.:\\windows\\
    </Blacklist>
  </Blacklists>
</XciDiscoveryConfig>]]></screen>
<para>The <literal>DiscoveryPaths</literal> element contains details of which directories to search for applications, and which file type to search for, specified by one or more <literal>DiscoveryPath</literal> elements. The following table describes the attributes of the <literal>DiscoveryPath</literal> element.</para>
   <informaltable frame="none" width="6.5in">
    <tgroup cols="3">
     <colspec colwidth="1.25in"/>
     <colspec colwidth="4.0in"/>
     <colspec colwidth="*"/>

     <thead>
      <row>
       <entry>
        <para>Attribute name</para>
       </entry>
       <entry>
        <para>Description</para>
       </entry>
       <entry>
        <para>Default</para>
       </entry>
      </row>
     </thead>
     <tbody>
	 <row>
       <entry>
        <para>Enabled</para>
       </entry>
       <entry>
        <para>If <literal>false</literal> the directory path is ignored.</para>
       </entry>
       <entry>
        <para>true</para>
       </entry>
      </row>
	   <row>
       <entry>
        <para>Recurse</para>
       </entry>
       <entry>
        <para>If <literal>true</literal> the application spider will recurse into sub-directories of the specified directory.</para>
       </entry>
       <entry>
        <para>true</para>
       </entry>
      </row>
	  <row>
       <entry>
        <para>Wildcard</para>
       </entry>
       <entry>
        <para>A file name matching wildcard.</para>
       </entry>
       <entry>
        <para><phrase role="die">*.lnk</phrase></para>
       </entry>
      </row>
	  <row>
       <entry>
        <para>Category</para>
       </entry>
       <entry>
        <para>Specifies the category under which the discovered applications will be grouped in &DAZZLE;, for example, <literal>Office Application</literal>. If no category is specified the applications will be grouped under their containing folder name.</para>
       </entry>
       <entry>
        <para>By default there is no category.</para>
       </entry>
      </row>
	  <row>
       <entry>
        <para>Keywords </para>
       </entry>
       <entry>
        <para>Space-delimited string of keywords for the discovered applications. The keyword <literal>Recommended</literal> causes found applications to be put into the <guilabel>FEATURED</guilabel> category in &DAZZLE;.</para>
       </entry>
       <entry>
        <para>By default there are no keywords.</para>
       </entry>
      </row>  

	   </tbody>
	 </tgroup>
	</informaltable>
<para>The <literal>Whitelists</literal> element contains one or more <literal>Whitelist</literal> elements. Each <literal>Whitelist</literal> element contains a regular expression that matches application to be included in the shareable list. The <literal>Whitelist</literal> element can have an <literal>IgnoreCase</literal> attribute which, if <literal>true</literal>,  causes the regular expression to be evaluated case-insensitively.</para>
<para>The <literal>BlackLists</literal> element specifies the regular expressions that match applications to be <emphasis>excluded</emphasis>. An application that matches both a <literal>Whitelist</literal> and a <literal>Blacklist</literal> element <emphasis>will</emphasis> be included in the list of shareable applications.</para>
</section>

	</appendix>
	
	-->
  <xi:include href="../shared/XenClientSetupAndUsageGuide.xml" xpointer="licenses" xmlns:xi="http://www.w3.org/2001/XInclude" /> 

<!-- <chapter role="NotInToc"><title role="invisible"></title>
&colophon;
</chapter> -->
<index />
</book>
